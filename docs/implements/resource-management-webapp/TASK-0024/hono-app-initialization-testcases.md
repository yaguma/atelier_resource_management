# TASK-0024: Hono.jsアプリケーション初期化 テストケース定義書

## タスク情報

- **タスクID**: TASK-0024
- **Issue番号**: #49
- **タスクタイプ**: TDD
- **要件**: WRREQ-001-1, WRREQ-067

---

## 開発言語・フレームワーク

### 🔵 プログラミング言語
- **言語**: TypeScript 5.0+
- **言語選択の理由**: プロジェクト全体でTypeScriptを使用しており、型安全性を確保するため
- **テストに適した機能**: 型チェックによるテストコードの品質向上

### 🔵 テストフレームワーク
- **フレームワーク**: Vitest 2.1.6+
- **フレームワーク選択の理由**: 
  - 設計文書（architecture.md）でバックエンドのユニットテストにVitestを使用することが明記されている
  - Hono.jsは標準のFetch APIを使用しており、Vitestの`fetch`モックと相性が良い
  - 高速なテスト実行とTypeScriptのネイティブサポート
- **テスト実行環境**: Node.js 18+ 環境で実行

---

## テストケース分類

### 1. 正常系テストケース（基本的な動作）

#### TC-001: ヘルスチェックエンドポイント正常系テスト 🔵

- **テスト名**: GET /health エンドポイントが正常に応答する
- **何をテストするか**: ヘルスチェックエンドポイントが正しく実装され、期待されるJSONレスポンスを返すことを確認
- **期待される動作**: 
  - HTTPステータスコード 200 を返す
  - レスポンスボディに `{"status": "ok"}` を含む
  - Content-Type が `application/json` である
- **入力値**: 
  - HTTPメソッド: GET
  - エンドポイント: `/health`
  - リクエストボディ: なし
- **入力データの意味**: ヘルスチェックは最も基本的なエンドポイントであり、サーバーの稼働状況を確認するために使用される
- **期待される結果**: 
  ```json
  {
    "status": "ok"
  }
  ```
  - HTTPステータスコード: 200
  - Content-Type: `application/json`
- **期待結果の理由**: 要件定義書で明記されている仕様に基づく
- **テストの目的**: ヘルスチェックエンドポイントの基本動作を確認し、サーバーが正常に起動していることを検証する
- **確認ポイント**: 
  - レスポンスのステータスコード
  - レスポンスボディの形式と内容
  - Content-Typeヘッダー

#### TC-002: ルートエンドポイント正常系テスト 🔵

- **テスト名**: GET / エンドポイントが正常に応答する
- **何をテストするか**: ルートエンドポイントが正しく実装され、期待されるJSONレスポンスを返すことを確認
- **期待される動作**: 
  - HTTPステータスコード 200 を返す
  - レスポンスボディに `{"message": "Atelier Resource Management API"}` を含む
  - Content-Type が `application/json` である
- **入力値**: 
  - HTTPメソッド: GET
  - エンドポイント: `/`
  - リクエストボディ: なし
- **入力データの意味**: ルートエンドポイントはAPIの基本情報を提供するエンドポイント
- **期待される結果**: 
  ```json
  {
    "message": "Atelier Resource Management API"
  }
  ```
  - HTTPステータスコード: 200
  - Content-Type: `application/json`
- **期待結果の理由**: 要件定義書で明記されている仕様に基づく
- **テストの目的**: ルートエンドポイントの基本動作を確認し、APIの基本情報が正しく返されることを検証する
- **確認ポイント**: 
  - レスポンスのステータスコード
  - レスポンスボディの形式と内容
  - Content-Typeヘッダー

#### TC-003: 存在しないエンドポイントへのリクエストテスト 🔴

- **テスト名**: 存在しないエンドポイントへのリクエストが404を返す
- **何をテストするか**: 存在しないエンドポイントへのリクエストが適切に処理されることを確認
- **期待される動作**: 
  - HTTPステータスコード 404 を返す
  - 適切なエラーメッセージを含む（Hono.jsのデフォルト動作）
- **入力値**: 
  - HTTPメソッド: GET
  - エンドポイント: `/nonexistent`
  - リクエストボディ: なし
- **入力データの意味**: 存在しないエンドポイントへのアクセスは一般的なエラーケース
- **期待される結果**: 
  - HTTPステータスコード: 404
  - エラーメッセージ（Hono.jsのデフォルト動作に従う）
- **期待結果の理由**: RESTful APIの一般的な動作として、存在しないリソースへのアクセスは404を返すべき
- **テストの目的**: エラーハンドリングの基本動作を確認し、存在しないエンドポイントへのアクセスが適切に処理されることを検証する
- **確認ポイント**: 
  - レスポンスのステータスコード
  - エラーレスポンスの形式

---

### 2. 異常系テストケース（エラーハンドリング）

#### TC-004: 不正なHTTPメソッドでのリクエストテスト 🔴

- **テスト名**: POSTメソッドでGETエンドポイントにアクセスした場合のエラーハンドリング
- **エラーケースの概要**: 許可されていないHTTPメソッドでエンドポイントにアクセスした場合の動作を確認
- **エラー処理の重要性**: RESTful APIでは、許可されていないHTTPメソッドに対して適切なエラーレスポンスを返す必要がある
- **入力値**: 
  - HTTPメソッド: POST
  - エンドポイント: `/health`
  - リクエストボディ: なし
- **不正な理由**: `/health`エンドポイントはGETメソッドのみを許可しているため、POSTメソッドは不正
- **実際の発生シナリオ**: クライアント側の実装ミスや、API仕様の誤解による誤ったリクエスト
- **期待される結果**: 
  - HTTPステータスコード: 405 (Method Not Allowed) または 404
  - エラーメッセージ（Hono.jsのデフォルト動作に従う）
- **エラーメッセージの内容**: Hono.jsのデフォルト動作に従う（実装時に確認）
- **システムの安全性**: エラー時にシステムが安全な状態を保てることを確認
- **テストの目的**: 不正なHTTPメソッドに対する適切なエラーハンドリングを確認する
- **品質保証の観点**: APIの堅牢性とセキュリティを確保する

---

### 3. 境界値テストケース（最小値、最大値、null等）

#### TC-005: 環境変数PORTが未設定の場合のデフォルトポート使用テスト 🔴

- **テスト名**: 環境変数PORTが未設定の場合、デフォルトポート3000を使用する
- **境界値の意味**: 環境変数の有無による動作の違いを確認
- **境界値での動作保証**: 環境変数が設定されていない場合でも、アプリケーションが正常に動作することを保証
- **入力値**: 
  - 環境変数 `PORT`: 未設定（undefined）
  - 期待されるポート: 3000（デフォルト値）
- **境界値選択の根拠**: 要件定義書で「環境変数 `PORT`（オプション、デフォルト: 3000）」と明記されている
- **実際の使用場面**: 開発環境やCI/CD環境で環境変数が設定されていない場合
- **期待される結果**: 
  - サーバーがポート3000で起動する
  - 起動ログに `Server is running on http://localhost:3000` が表示される
- **境界での正確性**: 環境変数が未設定でも、デフォルト値が正しく適用されることを確認
- **一貫した動作**: 環境変数の有無に関わらず、一貫した動作を保証
- **テストの目的**: 環境変数のデフォルト値処理を確認し、環境変数が設定されていない場合でも正常に動作することを検証する
- **堅牢性の確認**: 環境変数の設定状況に関わらず、システムが安定動作することを確認

#### TC-006: 環境変数PORTが設定されている場合のポート使用テスト 🔴

- **テスト名**: 環境変数PORTが設定されている場合、そのポートを使用する
- **境界値の意味**: 環境変数が設定されている場合の動作を確認
- **境界値での動作保証**: 環境変数が設定されている場合、その値が正しく使用されることを保証
- **入力値**: 
  - 環境変数 `PORT`: `8080`（例）
  - 期待されるポート: 8080
- **境界値選択の根拠**: 環境変数が設定されている場合の動作を確認するため
- **実際の使用場面**: 本番環境やステージング環境で特定のポートを指定する場合
- **期待される結果**: 
  - サーバーが指定されたポート（例: 8080）で起動する
  - 起動ログに `Server is running on http://localhost:8080` が表示される
- **境界での正確性**: 環境変数の値が正しく読み込まれ、適用されることを確認
- **一貫した動作**: 環境変数の値に関わらず、一貫した動作を保証
- **テストの目的**: 環境変数の読み込み処理を確認し、設定されたポートが正しく使用されることを検証する
- **堅牢性の確認**: 環境変数の値が正しく処理されることを確認

---

## テスト実装時の日本語コメント指針

### テストケース開始時のコメント

```typescript
// 【テスト目的】: ヘルスチェックエンドポイントが正常に応答することを確認
// 【テスト内容】: GET /health エンドポイントにリクエストを送信し、期待されるJSONレスポンスが返されることを検証
// 【期待される動作】: HTTPステータスコード200と共に、{"status": "ok"}が返される
// 🔵 要件定義書に基づく確実なテスト
```

### Given（準備フェーズ）のコメント

```typescript
// 【テストデータ準備】: Honoアプリケーションインスタンスを作成し、テスト対象のエンドポイントを設定
// 【初期条件設定】: テスト実行前にアプリケーションを初期化し、必要なルートを登録
// 【前提条件確認】: Hono.jsが正しくインストールされ、動作することを前提とする
```

### When（実行フェーズ）のコメント

```typescript
// 【実際の処理実行】: fetch APIを使用してGET /healthエンドポイントにリクエストを送信
// 【処理内容】: Honoアプリケーションのfetchメソッドを呼び出し、エンドポイントへのリクエストをシミュレート
// 【実行タイミング】: アプリケーション初期化後、エンドポイントが登録された状態で実行
```

### Then（検証フェーズ）のコメント

```typescript
// 【結果検証】: レスポンスのステータスコード、Content-Type、レスポンスボディを検証
// 【期待値確認】: 要件定義書で明記された仕様に基づき、期待される値と一致することを確認
// 【品質保証】: この検証により、ヘルスチェックエンドポイントの基本動作が保証される
```

### 各expectステートメントのコメント

```typescript
// 【検証項目】: HTTPステータスコードが200であることを確認
// 🔵 要件定義書に基づく確実な検証
expect(response.status).toBe(200);

// 【検証項目】: レスポンスボディが期待される形式であることを確認
// 🔵 要件定義書に基づく確実な検証
expect(await response.json()).toEqual({ status: 'ok' });
```

---

## テスト実装の優先順位

### 高優先度（即座に実装推奨）

1. **TC-001**: ヘルスチェックエンドポイント正常系テスト 🔵
   - 理由: 最も基本的なエンドポイントであり、サーバーの稼働状況を確認するために必須
2. **TC-002**: ルートエンドポイント正常系テスト 🔵
   - 理由: APIの基本情報を提供するエンドポイントであり、基本的な動作確認に必要

### 中優先度（次のスプリントで実装）

3. **TC-003**: 存在しないエンドポイントへのリクエストテスト 🔴
   - 理由: エラーハンドリングの基本動作を確認するため
4. **TC-004**: 不正なHTTPメソッドでのリクエストテスト 🔴
   - 理由: APIの堅牢性とセキュリティを確保するため

### 低優先度（継続的改善として実装）

5. **TC-005**: 環境変数PORTが未設定の場合のデフォルトポート使用テスト 🔴
   - 理由: 環境変数のデフォルト値処理を確認するため（統合テストとして実装する可能性あり）
6. **TC-006**: 環境変数PORTが設定されている場合のポート使用テスト 🔴
   - 理由: 環境変数の読み込み処理を確認するため（統合テストとして実装する可能性あり）

---

## 品質判定

✅ **高品質**:
- テストケース分類: 正常系・異常系・境界値が網羅されている
- 期待値定義: 各テストケースの期待値が明確
- 技術選択: プログラミング言語（TypeScript）・テストフレームワーク（Vitest）が確定
- 実装可能性: 現在の技術スタックで実現可能

---

## 次のステップ

次のお勧めステップ: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。

