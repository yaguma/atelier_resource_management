# アトリエ錬金術ゲーム リソース管理Webアプリ 要件定義書

## 概要

本Webアプリケーションは、「アトリエ錬金術ゲーム」の開発支援ツールとして、ゲーム内リソース（カード、顧客、錬金スタイル、マップノード、メタ進行データなど）を効率的に管理するための管理画面を提供するものである。

**目的**: ゲームバランス調整、データ管理、コンテンツ追加を容易にする
**対象ユーザー**: ゲーム開発者、ゲームデザイナー
**技術スタック**:
- フロントエンド: React 18+ + Vite + TypeScript + TailwindCSS + React Router + TanStack Query + Zod + Axios
- バックエンド: Hono.js + TypeScript + Prisma + PostgreSQL

## 関連文書

- **ゲーム要件定義書**: [📖 atelier-requirements.md](atelier-requirements.md)

---

## 機能要件(EARS記法)

**【信頼性レベル凡例】**:
- 🔵 **青信号**: ゲーム要件定義書から直接導出された確実な要件
- 🟡 **黄信号**: ゲーム要件定義書から妥当な推測による要件
- 🔴 **赤信号**: 一般的なWebアプリ管理画面の要件から推測

---

### 1. プラットフォーム・技術基盤

#### 通常要件

- **WRREQ-001**: システムのフロントエンドはReact 18以上で開発されなければならない 🟡 *モダンなWeb開発のベストプラクティスから*
- **WRREQ-001-1**: システムのバックエンドはHono.jsで開発されなければならない 🟡 *軽量高速なAPIフレームワークのため*
- **WRREQ-001-2**: システムのフロントエンドはViteをビルドツールとして使用しなければならない 🟡 *高速な開発体験のため*
- **WRREQ-001-3**: システムのフロントエンドはReact Routerをルーティングライブラリとして使用しなければならない 🟡 *SPAのルーティング管理のため*
- **WRREQ-001-4**: システムのフロントエンドはTanStack Query(React Query)でサーバー状態管理を行わなければならない 🟡 *効率的なデータフェッチ・キャッシング・同期のため*
- **WRREQ-001-5**: システムのフロントエンドはZodでスキーマバリデーションとTypeScript型生成を行わなければならない 🟡 *型安全なバリデーションのため*
- **WRREQ-001-6**: システムのフロントエンドはAxiosをHTTPクライアントとして使用しなければならない 🟡 *インターセプター、エラーハンドリングの容易さのため*
- **WRREQ-002**: システムはTypeScriptで型安全に実装されなければならない 🟡 *保守性・品質向上のため*
- **WRREQ-003**: システムはPostgreSQLをデータベースとして使用しなければならない 🟡 *リレーショナルデータの管理に適している*
- **WRREQ-004**: システムはPrismaをORMとして使用しなければならない 🟡 *型安全なDB操作のため*
- **WRREQ-005**: システムのフロントエンドはTailwindCSSでスタイリングを行わなければならない 🟡 *開発効率・保守性向上のため*
- **WRREQ-006**: システムはレスポンシブデザインに対応しなければならない 🔴 *Web管理画面の一般要件*

#### 制約要件

- **WRREQ-007**: システムは開発環境でローカルホストで動作しなければならない 🔴 *開発効率のため*
- **WRREQ-008**: システムのフロントエンドはAzure App Serviceにデプロイ可能でなければならない 🟡 *エンタープライズ環境での運用のため*
- **WRREQ-008-1**: システムのバックエンドAPIはAzure App Serviceにデプロイ可能でなければならない 🟡 *フロントエンドと統一した運用環境のため*
- **WRREQ-008-2**: システムはAzure Database for PostgreSQLを使用できなければならない 🟡 *Azure環境でのデータベース運用のため*

---

### 2. 認証・権限管理

#### 通常要件

- **WRREQ-009**: システムはMVPとして認証機能を実装しなくてもよい 🔴 *開発初期は単一開発者のため*

#### オプション要件

- **WRREQ-010**: システムは将来的にJWT(JSON Web Token)を使用した認証を実装してもよい 🔴 *将来的な拡張性のため*
- **WRREQ-011**: システムは将来的にロールベースアクセス制御(RBAC)を実装してもよい 🔴 *複数開発者対応のため*

---

### 3. カード管理機能

#### 通常要件

- **WRREQ-012**: システムは6種類のカード系統(素材、操作、触媒、知識、特殊、アーティファクト)を管理しなければならない 🔵 *ゲーム要件REQ-022より*
- **WRREQ-013**: 各カードは名前、説明、カード系統、属性値、安定値、反応効果を持たなければならない 🔵 *ゲーム要件REQ-023より*
- **WRREQ-014**: 各カードはエネルギーコスト(0〜5)を持たなければならない 🔵 *ゲーム要件REQ-024-3より*
- **WRREQ-015**: システムはカードの進化・合成ルールを定義できなければならない 🔵 *ゲーム要件REQ-025より*
- **WRREQ-016**: システムはカードの一覧表示、検索、フィルタリング機能を提供しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-017**: システムはカードの新規作成、編集、削除機能を提供しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-018**: システムはカードデータをJSON形式でエクスポート/インポートできなければならない 🔵 *ゲーム要件NFR-008より*

#### 条件付き要件

- **WRREQ-019**: カードを削除する場合、システムは依存関係をチェックし、警告を表示しなければならない 🔴 *データ整合性のため*
- **WRREQ-020**: 同名のカードが既に存在する場合、システムは重複エラーを表示しなければならない 🔴 *データ整合性のため*

---

### 4. 顧客管理機能

#### 通常要件

- **WRREQ-021**: システムは顧客タイプの管理機能を提供しなければならない 🔵 *ゲーム要件REQ-032より*
- **WRREQ-022**: 各顧客は名前、説明、タイプ、難易度(1〜5星)を持たなければならない 🔵 *ゲーム要件REQ-031より*
- **WRREQ-023**: 各顧客依頼は指定属性値、品質条件、安定性条件を持たなければならない 🔵 *ゲーム要件REQ-030より*
- **WRREQ-024**: 各顧客は報酬設定(カード、名声、知識ポイント)を持たなければならない 🔵 *ゲーム要件REQ-036, REQ-039より*
- **WRREQ-025**: システムは顧客の一覧表示、検索、フィルタリング機能を提供しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-026**: システムは顧客の新規作成、編集、削除機能を提供しなければならない 🔴 *管理画面の一般要件*

#### 制約要件

- **WRREQ-027**: システムはMVPとして最低5種類の顧客を登録しなければならない 🔵 *ゲーム要件REQ-032より*
- **WRREQ-028**: システムは正式リリース時に20種類以上の顧客を登録できなければならない 🔵 *ゲーム要件REQ-032-1より*

---

### 5. 錬金スタイル管理機能

#### 通常要件

- **WRREQ-029**: システムは錬金スタイルの管理機能を提供しなければならない 🔵 *ゲーム要件REQ-019, REQ-020より*
- **WRREQ-030**: 各錬金スタイルは名前、説明、初期デッキ構成、特徴を持たなければならない 🔵 *ゲーム要件REQ-020より*
- **WRREQ-031**: システムは錬金スタイルの新規作成、編集、削除機能を提供しなければならない 🔴 *管理画面の一般要件*

#### オプション要件

- **WRREQ-032**: システムは将来的に5種類の錬金スタイル(火、水、毒、鉱、精霊)を管理してもよい 🔵 *ゲーム要件REQ-020より*

---

### 6. マップ・ノード管理機能

#### 通常要件

- **WRREQ-033**: システムは5種類のノードタイプ(依頼、商人、実験、魔物、ボス依頼)を管理しなければならない 🔵 *ゲーム要件REQ-016より*
- **WRREQ-034**: 各ノードは名前、タイプ、説明、報酬、イベント内容を持たなければならない 🔵 *ゲーム要件REQ-016-1, REQ-016-2より*
- **WRREQ-035**: システムはマップテンプレートの作成・編集機能を提供しなければならない 🔵 *ゲーム要件REQ-015より*
- **WRREQ-036**: 各マップテンプレートは30〜50個のノードを配置できなければならない 🔵 *ゲーム要件REQ-015-1より*
- **WRREQ-037**: システムはノードの一覧表示、検索、フィルタリング機能を提供しなければならない 🔴 *管理画面の一般要件*

---

### 7. メタ進行データ管理機能

#### 通常要件

- **WRREQ-038**: システムはメタ通貨(名声、知識ポイント)の設定を管理しなければならない 🔵 *ゲーム要件REQ-039より*
- **WRREQ-039**: システムはアンロック可能コンテンツ(新カード、新素材、新顧客)を管理しなければならない 🔵 *ゲーム要件REQ-040より*
- **WRREQ-040**: 各アンロック項目は必要コスト(名声/知識ポイント)を持たなければならない 🔵 *ゲーム要件REQ-040より*
- **WRREQ-041**: システムはアセンション難易度設定を管理しなければならない 🔵 *ゲーム要件REQ-041より*
- **WRREQ-042**: システムはアセンション難易度を最大20レベルまで設定できなければならない 🔵 *ゲーム要件REQ-041-1より*

---

### 8. データエクスポート/インポート機能

#### 通常要件

- **WRREQ-043**: システムは全てのゲームデータをJSON形式でエクスポートできなければならない 🔵 *ゲーム要件NFR-008より*
- **WRREQ-044**: システムはJSON形式のデータをインポートできなければならない 🔵 *ゲーム要件NFR-008より*
- **WRREQ-045**: システムはエクスポート時にデータの整合性をバリデーションしなければならない 🔴 *データ品質保証のため*
- **WRREQ-046**: システムはインポート時にスキーマバリデーションを行わなければならない 🔴 *データ品質保証のため*

#### 条件付き要件

- **WRREQ-047**: インポートデータにエラーがある場合、システムは詳細なエラーメッセージを表示し、インポートを中止しなければならない 🔴 *データ整合性のため*

---

### 9. ゲームバランス調整機能

#### 通常要件

- **WRREQ-048**: システムはエネルギーシステムの設定(初期値、最大値)を管理しなければならない 🔵 *ゲーム要件REQ-024-1, REQ-024-2より*
- **WRREQ-049**: システムは手札システムの設定(初期枚数、ドロー枚数)を管理しなければならない 🔵 *ゲーム要件REQ-026-1, REQ-026-2より*
- **WRREQ-050**: システムは暴発条件(安定値閾値)を設定できなければならない 🔵 *ゲーム要件REQ-033より*
- **WRREQ-051**: システムはプレイ時間目標(20〜40分)に基づくバランス調整メモを記録できなければならない 🔵 *ゲーム要件REQ-018より*

---

### 10. UI/UX要件

#### 通常要件

- **WRREQ-052**: システムはダッシュボード画面で統計情報(総カード数、総顧客数など)を表示しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-053**: システムは左サイドバーでナビゲーションを提供しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-054**: システムはパンくずリストで現在位置を表示しなければならない 🔴 *ユーザビリティ向上のため*
- **WRREQ-055**: システムはフォームバリデーションエラーを分かりやすく表示しなければならない 🔴 *ユーザビリティ向上のため*
- **WRREQ-056**: システムは削除操作時に確認ダイアログを表示しなければならない 🔴 *誤操作防止のため*
- **WRREQ-057**: システムは操作成功時にトースト通知を表示しなければならない 🔴 *フィードバック向上のため*

#### 制約要件

- **WRREQ-058**: システムは日本語UIのみをサポートすればよい 🔵 *ゲーム要件NFR-005より*

---

### 11. 検索・フィルタリング機能

#### 通常要件

- **WRREQ-059**: システムは各リソースタイプで名前による部分一致検索を提供しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-060**: システムはカードをカード系統でフィルタリングできなければならない 🔵 *ゲーム要件REQ-022より*
- **WRREQ-061**: システムは顧客を難易度でフィルタリングできなければならない 🔵 *ゲーム要件REQ-031より*
- **WRREQ-062**: システムはノードをノードタイプでフィルタリングできなければならない 🔵 *ゲーム要件REQ-016より*
- **WRREQ-063**: システムは検索・フィルタ条件をURLクエリパラメータで保持しなければならない 🔴 *ユーザビリティ向上のため*

---

### 12. バージョン管理・履歴機能

#### オプション要件

- **WRREQ-064**: システムは将来的にデータ変更履歴を記録してもよい 🔴 *将来的な拡張性のため*
- **WRREQ-065**: システムは将来的にバージョン管理機能を実装してもよい 🔴 *将来的な拡張性のため*
- **WRREQ-066**: システムは将来的にロールバック機能を実装してもよい 🔴 *将来的な拡張性のため*

---

### 13. API設計

#### 通常要件

- **WRREQ-067**: システムはHono.jsを使用してRESTful APIを提供しなければならない 🟡 *Web APIのベストプラクティスから*
- **WRREQ-068**: APIは適切なHTTPステータスコード(200, 201, 400, 404, 500など)を返さなければならない 🔴 *REST APIの一般要件*
- **WRREQ-069**: APIはエラー時に構造化されたエラーレスポンスを返さなければならない 🔴 *エラーハンドリングのため*
- **WRREQ-070**: APIは入力データのバリデーションを行わなければならない 🔴 *データ品質保証のため*
- **WRREQ-070-1**: システムはCORS(Cross-Origin Resource Sharing)を適切に設定しなければならない 🔴 *フロントエンドとバックエンドの分離のため*
- **WRREQ-070-2**: APIはHono.jsのミドルウェアを活用してバリデーション、ロギング、エラーハンドリングを実装しなければならない 🟡 *保守性向上のため*

---

### 14. APIエンドポイント仕様

#### ベースURL
- 開発環境: `http://localhost:3000/api`
- 本番環境: `https://{app-name}.azurewebsites.net/api`

#### 共通レスポンス形式

**成功時:**
```json
{
  "data": { ... },
  "message": "Success"
}
```

**エラー時:**
```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "エラーメッセージ",
    "details": [ ... ]
  }
}
```

#### カード管理API

- **GET /api/cards** - カード一覧取得
  - クエリパラメータ: `?page=1&limit=20&cardType=MATERIAL&search=炎`
  - レスポンス: `{ data: { items: Card[], total: number, page: number, limit: number } }`

- **GET /api/cards/:id** - カード詳細取得
  - パスパラメータ: `id` (UUID)
  - レスポンス: `{ data: Card }`

- **POST /api/cards** - カード新規作成
  - リクエストボディ: `{ name, description, cardType, attribute, stabilityValue, energyCost, ... }`
  - レスポンス: `{ data: Card, message: "カードを作成しました" }`

- **PUT /api/cards/:id** - カード更新
  - パスパラメータ: `id` (UUID)
  - リクエストボディ: `{ name?, description?, ... }` (部分更新可)
  - レスポンス: `{ data: Card, message: "カードを更新しました" }`

- **DELETE /api/cards/:id** - カード削除（ソフトデリート）
  - パスパラメータ: `id` (UUID)
  - レスポンス: `{ message: "カードを削除しました" }`

#### 顧客管理API

- **GET /api/customers** - 顧客一覧取得
  - クエリパラメータ: `?page=1&limit=20&difficulty=3&search=商人`
  - レスポンス: `{ data: { items: Customer[], total: number, page: number, limit: number } }`

- **GET /api/customers/:id** - 顧客詳細取得
  - パスパラメータ: `id` (UUID)
  - レスポンス: `{ data: Customer }`

- **POST /api/customers** - 顧客新規作成
  - リクエストボディ: `{ name, description, customerType, difficulty, ... }`
  - レスポンス: `{ data: Customer, message: "顧客を作成しました" }`

- **PUT /api/customers/:id** - 顧客更新
  - パスパラメータ: `id` (UUID)
  - リクエストボディ: `{ name?, description?, ... }`
  - レスポンス: `{ data: Customer, message: "顧客を更新しました" }`

- **DELETE /api/customers/:id** - 顧客削除（ソフトデリート）
  - パスパラメータ: `id` (UUID)
  - レスポンス: `{ message: "顧客を削除しました" }`

#### 錬金スタイル管理API

- **GET /api/alchemy-styles** - 錬金スタイル一覧取得
  - レスポンス: `{ data: AlchemyStyle[] }`

- **GET /api/alchemy-styles/:id** - 錬金スタイル詳細取得
  - パスパラメータ: `id` (UUID)
  - レスポンス: `{ data: AlchemyStyle }`

- **POST /api/alchemy-styles** - 錬金スタイル新規作成
  - リクエストボディ: `{ name, description, characteristics, initialDeckCardIds: string[] }`
  - レスポンス: `{ data: AlchemyStyle, message: "錬金スタイルを作成しました" }`

- **PUT /api/alchemy-styles/:id** - 錬金スタイル更新
  - パスパラメータ: `id` (UUID)
  - リクエストボディ: `{ name?, description?, ... }`
  - レスポンス: `{ data: AlchemyStyle, message: "錬金スタイルを更新しました" }`

- **DELETE /api/alchemy-styles/:id** - 錬金スタイル削除（ソフトデリート）
  - パスパラメータ: `id` (UUID)
  - レスポンス: `{ message: "錬金スタイルを削除しました" }`

#### マップノード管理API

- **GET /api/map-nodes** - マップノード一覧取得
  - クエリパラメータ: `?nodeType=REQUEST&page=1&limit=20`
  - レスポンス: `{ data: { items: MapNode[], total: number, page: number, limit: number } }`

- **GET /api/map-nodes/:id** - マップノード詳細取得
- **POST /api/map-nodes** - マップノード新規作成
- **PUT /api/map-nodes/:id** - マップノード更新
- **DELETE /api/map-nodes/:id** - マップノード削除（ソフトデリート）

#### ゲームバランス管理API

- **GET /api/game-balance** - ゲームバランス設定一覧取得
  - クエリパラメータ: `?category=ENERGY`
  - レスポンス: `{ data: GameBalance[] }`

- **GET /api/game-balance/:id** - ゲームバランス設定詳細取得
- **PUT /api/game-balance/:id** - ゲームバランス設定更新
  - リクエストボディ: `{ settingValue, description? }`
  - レスポンス: `{ data: GameBalance, message: "設定を更新しました" }`

#### データエクスポート/インポートAPI

- **GET /api/export** - 全データエクスポート
  - クエリパラメータ: `?resources=cards,customers` (省略時は全データ)
  - レスポンス: JSONファイルダウンロード

- **POST /api/import** - データインポート
  - リクエスト: `multipart/form-data` (JSONファイル)
  - レスポンス: `{ message: "データをインポートしました", imported: { cards: 10, customers: 5 } }`

#### HTTPステータスコード

- **200 OK**: 成功（GET, PUT）
- **201 Created**: リソース作成成功（POST）
- **204 No Content**: 削除成功（DELETE）
- **400 Bad Request**: バリデーションエラー
- **404 Not Found**: リソースが見つからない
- **409 Conflict**: 重複エラー（ユニーク制約違反）
- **500 Internal Server Error**: サーバーエラー

---

## 非機能要件

### パフォーマンス

- **WRNFR-001**: システムは一覧画面の初期表示を2秒以内に完了しなければならない 🔴 *ユーザビリティのため*
- **WRNFR-002**: システムは1000件以上のデータでもページネーションで快適に操作できなければならない 🔴 *スケーラビリティのため*
- **WRNFR-003**: システムは検索・フィルタリング処理を500ms以内に完了しなければならない 🔴 *ユーザビリティのため*

### セキュリティ

- **WRNFR-004**: システムはSQL インジェクション対策を実装しなければならない 🔴 *セキュリティ基本要件*
- **WRNFR-005**: システムはXSS(クロスサイトスクリプティング)対策を実装しなければならない 🔴 *セキュリティ基本要件*
- **WRNFR-006**: システムはCSRF(クロスサイトリクエストフォージェリ)対策を実装しなければならない 🔴 *セキュリティ基本要件*

### ユーザビリティ

- **WRNFR-007**: システムは直感的で学習コストの低いUIを提供しなければならない 🔴 *ユーザビリティのため*
- **WRNFR-008**: システムは一貫性のあるデザインシステムを採用しなければならない 🔴 *ユーザビリティのため*

### 保守性

- **WRNFR-009**: システムはコンポーネント志向の設計でなければならない 🟡 *保守性向上のため*
- **WRNFR-010**: システムはESLintとPrettierで静的解析とコード整形を行わなければならない 🟡 *コード品質向上のため*
- **WRNFR-011**: システムはエラーログを記録し、デバッグを容易にしなければならない 🔴 *開発効率のため*

### テスタビリティ

- **WRNFR-012**: システムはユニットテストを実装しなければならない 🔴 *品質保証のため*
- **WRNFR-013**: システムは統合テストを実装しなければならない 🔴 *品質保証のため*
- **WRNFR-014**: システムはE2Eテストを実装してもよい 🔴 *品質保証のため(オプション)*

---

## Edgeケース

### エラー処理

- **WREDGE-001**: データベース接続エラーが発生した場合、システムはユーザーにわかりやすいエラーメッセージを表示しなければならない 🔴 *エラー処理一般要件*
- **WREDGE-002**: ファイルアップロード時にサイズ制限(10MB)を超えた場合、システムはエラーメッセージを表示しなければならない 🔴 *エラー処理一般要件*
- **WREDGE-003**: 不正なJSON形式のインポートファイルを受け取った場合、システムは詳細なエラー位置を表示しなければならない 🔴 *エラー処理一般要件*

### 境界値

- **WREDGE-004**: カード名が100文字を超えた場合、システムはバリデーションエラーを表示しなければならない 🔴 *データ品質保証のため*
- **WREDGE-005**: エネルギーコストがマイナス値の場合、システムはバリデーションエラーを表示しなければならない 🔴 *データ品質保証のため*
- **WREDGE-006**: 難易度が1〜5の範囲外の場合、システムはバリデーションエラーを表示しなければならない 🔵 *ゲーム要件REQ-031より*

### データ整合性

- **WREDGE-007**: 他のリソースから参照されているカードを削除しようとした場合、システムは警告メッセージを表示しなければならない 🔴 *データ整合性のため*
- **WREDGE-008**: 存在しない顧客IDを参照する依頼を作成しようとした場合、システムはエラーメッセージを表示しなければならない 🔴 *データ整合性のため*

---

## データモデル概要

### 共通フィールド（全エンティティ）

全てのエンティティは以下の共通フィールドを持つ:
- **id**: String (UUID v4, 主キー)
- **createdAt**: DateTime (作成日時、自動設定)
- **updatedAt**: DateTime (更新日時、自動更新)
- **deletedAt**: DateTime? (削除日時、ソフトデリート用、nullable)

### 主要エンティティ

#### 1. Card(カード)

**属性:**
- id, createdAt, updatedAt, deletedAt (共通フィールド)
- **name**: String (カード名、最大100文字、必須、ユニーク制約)
- **description**: String (説明、最大1000文字、必須)
- **cardType**: Enum (カード系統: MATERIAL, OPERATION, CATALYST, KNOWLEDGE, SPECIAL, ARTIFACT)
- **attribute**: String (属性値、JSON形式、例: {"fire":5,"water":3})
- **stabilityValue**: Int (安定値、範囲: -100〜100)
- **reactionEffect**: String? (反応効果、最大500文字、nullable)
- **energyCost**: Int (エネルギーコスト、範囲: 0〜5、必須)
- **imageUrl**: String? (カード画像URL、nullable)
- **rarity**: Enum? (レア度: COMMON, UNCOMMON, RARE, EPIC, LEGENDARY、nullable)

**リレーション:**
- **evolutionFrom**: Card? (進化元カード、1:1、nullable)
- **evolutionTo**: Card[] (進化先カード、1:N)
- **initialDeckStyles**: AlchemyStyle[] (このカードを初期デッキに含む錬金スタイル、N:M)
- **unlockableContent**: UnlockableContent? (このカードのアンロック条件、1:1、nullable)

#### 2. Customer(顧客)

**属性:**
- id, createdAt, updatedAt, deletedAt (共通フィールド)
- **name**: String (顧客名、最大100文字、必須)
- **description**: String (説明、最大1000文字、必須)
- **customerType**: String (顧客タイプ、最大50文字、必須)
- **difficulty**: Int (難易度、範囲: 1〜5星、必須)
- **requiredAttribute**: String (必要属性値、JSON形式)
- **qualityCondition**: Int (品質条件、範囲: 0〜100)
- **stabilityCondition**: Int (安定性条件、範囲: 0〜100)
- **rewardFame**: Int (報酬: 名声、範囲: 0〜1000)
- **rewardKnowledge**: Int (報酬: 知識ポイント、範囲: 0〜1000)
- **portraitUrl**: String? (顧客ポートレートURL、nullable)

**リレーション:**
- **rewardCards**: Card[] (報酬カード、N:M)
- **mapNodes**: MapNode[] (この顧客が登場するノード、1:N)
- **unlockableContent**: UnlockableContent? (この顧客のアンロック条件、1:1、nullable)

#### 3. AlchemyStyle(錬金スタイル)

**属性:**
- id, createdAt, updatedAt, deletedAt (共通フィールド)
- **name**: String (スタイル名、最大100文字、必須、ユニーク制約)
- **description**: String (説明、最大1000文字、必須)
- **characteristics**: String (特徴、最大500文字、必須)
- **iconUrl**: String? (アイコンURL、nullable)

**リレーション:**
- **initialDeckCards**: Card[] (初期デッキのカード、N:M)

#### 4. MapNode(マップノード)

**属性:**
- id, createdAt, updatedAt, deletedAt (共通フィールド)
- **name**: String (ノード名、最大100文字、必須)
- **nodeType**: Enum (ノードタイプ: REQUEST, MERCHANT, EXPERIMENT, MONSTER, BOSS_REQUEST)
- **description**: String (説明、最大1000文字、必須)
- **eventContent**: String (イベント内容、JSON形式、必須)
- **rewards**: String? (報酬、JSON形式、nullable)
- **iconUrl**: String? (アイコンURL、nullable)

**リレーション:**
- **customer**: Customer? (このノードの顧客、N:1、nullable)

#### 5. MetaCurrency(メタ通貨)

**属性:**
- id, createdAt, updatedAt, deletedAt (共通フィールド)
- **currencyType**: Enum (通貨タイプ: FAME, KNOWLEDGE、ユニーク制約)
- **description**: String (説明、最大500文字、必須)
- **iconUrl**: String? (アイコンURL、nullable)

#### 6. UnlockableContent(アンロック可能コンテンツ)

**属性:**
- id, createdAt, updatedAt, deletedAt (共通フィールド)
- **contentType**: Enum (コンテンツタイプ: CARD, CUSTOMER, MATERIAL)
- **requiredFame**: Int (必要名声、範囲: 0〜10000、デフォルト: 0)
- **requiredKnowledge**: Int (必要知識ポイント、範囲: 0〜10000、デフォルト: 0)

**リレーション:**
- **card**: Card? (アンロック対象カード、1:1、nullable)
- **customer**: Customer? (アンロック対象顧客、1:1、nullable)

#### 7. GameBalance(ゲームバランス)

**属性:**
- id, createdAt, updatedAt, deletedAt (共通フィールド)
- **settingKey**: String (設定キー、最大100文字、必須、ユニーク制約)
- **settingValue**: String (設定値、最大500文字、必須)
- **description**: String (説明、最大500文字、必須)
- **category**: Enum (カテゴリ: ENERGY, HAND, STABILITY, PLAYTIME)

**設定例:**
- `energy_initial_value`: 3 (初期エネルギー)
- `energy_max_value`: 10 (最大エネルギー)
- `hand_initial_count`: 5 (初期手札枚数)
- `hand_draw_count`: 5 (ドロー枚数)
- `stability_explosion_threshold`: 0 (暴発閾値)

### ER図概要（主要リレーション）

```
Card 1---* Card (進化関係)
Card *---* AlchemyStyle (初期デッキ)
Card 1---? UnlockableContent
Customer *---* Card (報酬)
Customer 1---* MapNode
Customer 1---? UnlockableContent
```

---

## 制約事項

### 技術的制約

- フロントエンド:
  - React 18以上
  - Vite 5.0以上
  - TypeScript 5.0以上
  - Node.js 18以上
  - React Router 6以上
  - TanStack Query (React Query) 5.0以上
  - Zod 3.0以上
  - Axios 1.6以上
- バックエンド:
  - Hono.js 4.0以上
  - TypeScript 5.0以上
  - Node.js 18以上
- データベース:
  - PostgreSQL 14以上（開発環境）
  - Azure Database for PostgreSQL（本番環境）
- ORM: Prisma 5.0以上
- デプロイ環境: Azure App Service（フロントエンド・バックエンド共通）

### ビジネス制約

- 無料開発ツール(個人開発プロジェクト)
- 開発期限は設定しない

### 設計制約

- フロントエンド: SPA(シングルページアプリケーション)アーキテクチャ、React Routerによるクライアントサイドルーティング
- バックエンド: RESTful API設計原則の遵守、Hono.jsのミドルウェア活用
- データベースマイグレーションの管理(Prisma Migrate)
- 環境変数による設定管理（Azure App Serviceのアプリケーション設定を活用）
- フロントエンドとバックエンドの完全な分離（独立したデプロイ・スケーリング）
- Azure App Serviceのデプロイスロット機能を活用したステージング環境の構築

---

## 優先順位(MoSCoW法)

### Must Have(必須 - MVP範囲)

- WRREQ-001〜008-2(プラットフォーム基盤、React+Vite+TanStack Query+Zod+Axios、Hono.js、Azure App Service含む)
- WRREQ-012〜018(カード管理機能)
- WRREQ-021〜026(顧客管理機能)
- WRREQ-029〜031(錬金スタイル管理機能)
- WRREQ-043〜047(データエクスポート/インポート機能)
- WRREQ-052〜057(基本UI/UX)
- WRREQ-059〜063(検索・フィルタリング機能)
- WRREQ-067〜070-2(API設計、Hono.js関連要件含む)
- APIエンドポイント仕様（カード、顧客、錬金スタイル管理）
- データモデル（共通フィールド、リレーションシップ定義）
- WRNFR-001〜006(パフォーマンス・セキュリティ基本)
- WRNFR-009〜011(保守性基本)

### Should Have(推奨 - 正式リリース範囲)

- WRREQ-027〜028(顧客数制約)
- WRREQ-033〜037(マップ・ノード管理機能)
- WRREQ-038〜042(メタ進行データ管理機能)
- WRREQ-048〜051(ゲームバランス調整機能)
- WRNFR-007〜008(ユーザビリティ)
- WRNFR-012〜013(テスト)

### Could Have(あれば良い)

- WRREQ-010〜011(認証・権限管理)
- WRREQ-032(5種類の錬金スタイル)
- WRREQ-064〜066(バージョン管理・履歴機能)
- WRNFR-014(E2Eテスト)

### Won't Have(今回は対象外)

- モバイルアプリ版
- リアルタイム共同編集
- 多言語対応
- ゲームとの直接連携API

---

## 開発フェーズ

### Phase 1: MVP (1〜2週間)

1. プロジェクトセットアップ
   - フロントエンド: React 18+ + Vite + TypeScript + TailwindCSS + React Router
     - TanStack Query設定（QueryClient、キャッシュ戦略）
     - Axios設定（ベースURL、インターセプター）
     - Zod設定（バリデーションスキーマ定義）
   - バックエンド: Hono.js + TypeScript + Prisma + PostgreSQL
   - 開発環境構築(ローカルDB、環境変数設定)
2. データベーススキーマ設計・マイグレーション(Prisma)
   - ER図作成
   - Prismaスキーマ定義（共通フィールド、リレーション）
   - マイグレーションファイル作成・実行
3. バックエンドAPI実装
   - Hono.jsルーティング設定
   - カード管理API(CRUD)
   - 顧客管理API(CRUD)
   - CORS設定、バリデーション（Zod）、エラーハンドリング
4. フロントエンド実装
   - React Routerルーティング設定
   - Zodバリデーションスキーマ定義（Card、Customer）
   - TanStack Queryフック実装（useCards、useCustomers）
   - Axiosクライアント実装（API呼び出しラッパー）
   - カード管理画面(CRUD)
   - 顧客管理画面(CRUD)
   - 基本的なUI/UX(ダッシュボード、ナビゲーション)
5. JSONエクスポート/インポート機能

### Phase 2: 正式リリース準備 (2〜3週間)

1. 錬金スタイル管理機能(API + UI)
2. マップ・ノード管理機能(API + UI)
3. メタ進行データ管理機能(API + UI)
4. ゲームバランス調整機能(API + UI)
5. 検索・フィルタリング機能強化
6. UI/UXブラッシュアップ
7. テスト実装(バックエンド・フロントエンド)
8. Azure環境構築とデプロイ設定
   - Azure App Service作成(フロントエンド・バックエンド各1つ)
   - Azure Database for PostgreSQL構築
   - デプロイスロット設定(本番・ステージング)
   - 環境変数・アプリケーション設定
   - CI/CDパイプライン構築(GitHub Actions)

### Phase 3: 拡張機能 (継続的)

1. 認証・権限管理(JWT認証)
2. バージョン管理・履歴機能
3. データ分析・可視化機能
4. パフォーマンス最適化(キャッシング、クエリ最適化)

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2025-11-08 | 1.0 | 初版作成 |
| 2025-11-08 | 1.1 | バックエンドをHono.jsに変更。フロントエンド(Next.js)とバックエンド(Hono.js)を明確に分離。API要件、技術的制約、開発フェーズを更新 |
| 2025-11-08 | 1.2 | デプロイ先をAzure App Serviceに変更。Azure Database for PostgreSQL追加。デプロイスロット、CI/CD設定を開発フェーズに追加 |
| 2025-11-08 | 1.3 | フロントエンドをNext.jsからReact+Viteに変更。SPA構成、React Router追加。SSR/CSR記述を削除し、SPAアーキテクチャに統一 |
| 2025-11-08 | 1.4 | High Priority対応: (1)TanStack Query、Zod、Axios要件追加 (2)データモデルのリレーションシップ・共通フィールド定義追加 (3)APIエンドポイント仕様セクション追加 (4)開発フェーズ詳細化 |
