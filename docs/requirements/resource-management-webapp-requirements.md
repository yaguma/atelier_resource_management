# アトリエ錬金術ゲーム リソース管理Webアプリ 要件定義書

## 概要

本Webアプリケーションは、「アトリエ錬金術ゲーム」の開発支援ツールとして、ゲーム内リソース（カード、顧客、錬金スタイル、マップノード、メタ進行データなど）を効率的に管理するための管理画面を提供するものである。

**目的**: ゲームバランス調整、データ管理、コンテンツ追加を容易にする
**対象ユーザー**: ゲーム開発者、ゲームデザイナー
**技術スタック**: Next.js 14+ (App Router) + TypeScript + TailwindCSS + Prisma + PostgreSQL

## 関連文書

- **ゲーム要件定義書**: [📖 atelier-requirements.md](atelier-requirements.md)

---

## 機能要件(EARS記法)

**【信頼性レベル凡例】**:
- 🔵 **青信号**: ゲーム要件定義書から直接導出された確実な要件
- 🟡 **黄信号**: ゲーム要件定義書から妥当な推測による要件
- 🔴 **赤信号**: 一般的なWebアプリ管理画面の要件から推測

---

### 1. プラットフォーム・技術基盤

#### 通常要件

- **WRREQ-001**: システムはNext.js 14以上(App Router)で開発されなければならない 🟡 *モダンなWeb開発のベストプラクティスから*
- **WRREQ-002**: システムはTypeScriptで型安全に実装されなければならない 🟡 *保守性・品質向上のため*
- **WRREQ-003**: システムはPostgreSQLをデータベースとして使用しなければならない 🟡 *リレーショナルデータの管理に適している*
- **WRREQ-004**: システムはPrismaをORMとして使用しなければならない 🟡 *型安全なDB操作のため*
- **WRREQ-005**: システムはTailwindCSSでスタイリングを行わなければならない 🟡 *開発効率・保守性向上のため*
- **WRREQ-006**: システムはレスポンシブデザインに対応しなければならない 🔴 *Web管理画面の一般要件*

#### 制約要件

- **WRREQ-007**: システムは開発環境でローカルホストで動作しなければならない 🔴 *開発効率のため*
- **WRREQ-008**: システムは本番環境でVercelにデプロイ可能でなければならない 🟡 *Next.jsのベストプラクティスから*

---

### 2. 認証・権限管理

#### 通常要件

- **WRREQ-009**: システムはMVPとして認証機能を実装しなくてもよい 🔴 *開発初期は単一開発者のため*

#### オプション要件

- **WRREQ-010**: システムは将来的にNextAuth.jsを使用した認証を実装してもよい 🔴 *将来的な拡張性のため*
- **WRREQ-011**: システムは将来的にロールベースアクセス制御(RBAC)を実装してもよい 🔴 *複数開発者対応のため*

---

### 3. カード管理機能

#### 通常要件

- **WRREQ-012**: システムは6種類のカード系統(素材、操作、触媒、知識、特殊、アーティファクト)を管理しなければならない 🔵 *ゲーム要件REQ-022より*
- **WRREQ-013**: 各カードは名前、説明、カード系統、属性値、安定値、反応効果を持たなければならない 🔵 *ゲーム要件REQ-023より*
- **WRREQ-014**: 各カードはエネルギーコスト(0〜5)を持たなければならない 🔵 *ゲーム要件REQ-024-3より*
- **WRREQ-015**: システムはカードの進化・合成ルールを定義できなければならない 🔵 *ゲーム要件REQ-025より*
- **WRREQ-016**: システムはカードの一覧表示、検索、フィルタリング機能を提供しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-017**: システムはカードの新規作成、編集、削除機能を提供しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-018**: システムはカードデータをJSON形式でエクスポート/インポートできなければならない 🔵 *ゲーム要件NFR-008より*

#### 条件付き要件

- **WRREQ-019**: カードを削除する場合、システムは依存関係をチェックし、警告を表示しなければならない 🔴 *データ整合性のため*
- **WRREQ-020**: 同名のカードが既に存在する場合、システムは重複エラーを表示しなければならない 🔴 *データ整合性のため*

---

### 4. 顧客管理機能

#### 通常要件

- **WRREQ-021**: システムは顧客タイプの管理機能を提供しなければならない 🔵 *ゲーム要件REQ-032より*
- **WRREQ-022**: 各顧客は名前、説明、タイプ、難易度(1〜5星)を持たなければならない 🔵 *ゲーム要件REQ-031より*
- **WRREQ-023**: 各顧客依頼は指定属性値、品質条件、安定性条件を持たなければならない 🔵 *ゲーム要件REQ-030より*
- **WRREQ-024**: 各顧客は報酬設定(カード、名声、知識ポイント)を持たなければならない 🔵 *ゲーム要件REQ-036, REQ-039より*
- **WRREQ-025**: システムは顧客の一覧表示、検索、フィルタリング機能を提供しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-026**: システムは顧客の新規作成、編集、削除機能を提供しなければならない 🔴 *管理画面の一般要件*

#### 制約要件

- **WRREQ-027**: システムはMVPとして最低5種類の顧客を登録しなければならない 🔵 *ゲーム要件REQ-032より*
- **WRREQ-028**: システムは正式リリース時に20種類以上の顧客を登録できなければならない 🔵 *ゲーム要件REQ-032-1より*

---

### 5. 錬金スタイル管理機能

#### 通常要件

- **WRREQ-029**: システムは錬金スタイルの管理機能を提供しなければならない 🔵 *ゲーム要件REQ-019, REQ-020より*
- **WRREQ-030**: 各錬金スタイルは名前、説明、初期デッキ構成、特徴を持たなければならない 🔵 *ゲーム要件REQ-020より*
- **WRREQ-031**: システムは錬金スタイルの新規作成、編集、削除機能を提供しなければならない 🔴 *管理画面の一般要件*

#### オプション要件

- **WRREQ-032**: システムは将来的に5種類の錬金スタイル(火、水、毒、鉱、精霊)を管理してもよい 🔵 *ゲーム要件REQ-020より*

---

### 6. マップ・ノード管理機能

#### 通常要件

- **WRREQ-033**: システムは5種類のノードタイプ(依頼、商人、実験、魔物、ボス依頼)を管理しなければならない 🔵 *ゲーム要件REQ-016より*
- **WRREQ-034**: 各ノードは名前、タイプ、説明、報酬、イベント内容を持たなければならない 🔵 *ゲーム要件REQ-016-1, REQ-016-2より*
- **WRREQ-035**: システムはマップテンプレートの作成・編集機能を提供しなければならない 🔵 *ゲーム要件REQ-015より*
- **WRREQ-036**: 各マップテンプレートは30〜50個のノードを配置できなければならない 🔵 *ゲーム要件REQ-015-1より*
- **WRREQ-037**: システムはノードの一覧表示、検索、フィルタリング機能を提供しなければならない 🔴 *管理画面の一般要件*

---

### 7. メタ進行データ管理機能

#### 通常要件

- **WRREQ-038**: システムはメタ通貨(名声、知識ポイント)の設定を管理しなければならない 🔵 *ゲーム要件REQ-039より*
- **WRREQ-039**: システムはアンロック可能コンテンツ(新カード、新素材、新顧客)を管理しなければならない 🔵 *ゲーム要件REQ-040より*
- **WRREQ-040**: 各アンロック項目は必要コスト(名声/知識ポイント)を持たなければならない 🔵 *ゲーム要件REQ-040より*
- **WRREQ-041**: システムはアセンション難易度設定を管理しなければならない 🔵 *ゲーム要件REQ-041より*
- **WRREQ-042**: システムはアセンション難易度を最大20レベルまで設定できなければならない 🔵 *ゲーム要件REQ-041-1より*

---

### 8. データエクスポート/インポート機能

#### 通常要件

- **WRREQ-043**: システムは全てのゲームデータをJSON形式でエクスポートできなければならない 🔵 *ゲーム要件NFR-008より*
- **WRREQ-044**: システムはJSON形式のデータをインポートできなければならない 🔵 *ゲーム要件NFR-008より*
- **WRREQ-045**: システムはエクスポート時にデータの整合性をバリデーションしなければならない 🔴 *データ品質保証のため*
- **WRREQ-046**: システムはインポート時にスキーマバリデーションを行わなければならない 🔴 *データ品質保証のため*

#### 条件付き要件

- **WRREQ-047**: インポートデータにエラーがある場合、システムは詳細なエラーメッセージを表示し、インポートを中止しなければならない 🔴 *データ整合性のため*

---

### 9. ゲームバランス調整機能

#### 通常要件

- **WRREQ-048**: システムはエネルギーシステムの設定(初期値、最大値)を管理しなければならない 🔵 *ゲーム要件REQ-024-1, REQ-024-2より*
- **WRREQ-049**: システムは手札システムの設定(初期枚数、ドロー枚数)を管理しなければならない 🔵 *ゲーム要件REQ-026-1, REQ-026-2より*
- **WRREQ-050**: システムは暴発条件(安定値閾値)を設定できなければならない 🔵 *ゲーム要件REQ-033より*
- **WRREQ-051**: システムはプレイ時間目標(20〜40分)に基づくバランス調整メモを記録できなければならない 🔵 *ゲーム要件REQ-018より*

---

### 10. UI/UX要件

#### 通常要件

- **WRREQ-052**: システムはダッシュボード画面で統計情報(総カード数、総顧客数など)を表示しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-053**: システムは左サイドバーでナビゲーションを提供しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-054**: システムはパンくずリストで現在位置を表示しなければならない 🔴 *ユーザビリティ向上のため*
- **WRREQ-055**: システムはフォームバリデーションエラーを分かりやすく表示しなければならない 🔴 *ユーザビリティ向上のため*
- **WRREQ-056**: システムは削除操作時に確認ダイアログを表示しなければならない 🔴 *誤操作防止のため*
- **WRREQ-057**: システムは操作成功時にトースト通知を表示しなければならない 🔴 *フィードバック向上のため*

#### 制約要件

- **WRREQ-058**: システムは日本語UIのみをサポートすればよい 🔵 *ゲーム要件NFR-005より*

---

### 11. 検索・フィルタリング機能

#### 通常要件

- **WRREQ-059**: システムは各リソースタイプで名前による部分一致検索を提供しなければならない 🔴 *管理画面の一般要件*
- **WRREQ-060**: システムはカードをカード系統でフィルタリングできなければならない 🔵 *ゲーム要件REQ-022より*
- **WRREQ-061**: システムは顧客を難易度でフィルタリングできなければならない 🔵 *ゲーム要件REQ-031より*
- **WRREQ-062**: システムはノードをノードタイプでフィルタリングできなければならない 🔵 *ゲーム要件REQ-016より*
- **WRREQ-063**: システムは検索・フィルタ条件をURLクエリパラメータで保持しなければならない 🔴 *ユーザビリティ向上のため*

---

### 12. バージョン管理・履歴機能

#### オプション要件

- **WRREQ-064**: システムは将来的にデータ変更履歴を記録してもよい 🔴 *将来的な拡張性のため*
- **WRREQ-065**: システムは将来的にバージョン管理機能を実装してもよい 🔴 *将来的な拡張性のため*
- **WRREQ-066**: システムは将来的にロールバック機能を実装してもよい 🔴 *将来的な拡張性のため*

---

### 13. API設計

#### 通常要件

- **WRREQ-067**: システムはRESTful APIを提供しなければならない 🟡 *Web APIのベストプラクティスから*
- **WRREQ-068**: APIは適切なHTTPステータスコード(200, 201, 400, 404, 500など)を返さなければならない 🔴 *REST APIの一般要件*
- **WRREQ-069**: APIはエラー時に構造化されたエラーレスポンスを返さなければならない 🔴 *エラーハンドリングのため*
- **WRREQ-070**: APIは入力データのバリデーションを行わなければならない 🔴 *データ品質保証のため*

---

## 非機能要件

### パフォーマンス

- **WRNFR-001**: システムは一覧画面の初期表示を2秒以内に完了しなければならない 🔴 *ユーザビリティのため*
- **WRNFR-002**: システムは1000件以上のデータでもページネーションで快適に操作できなければならない 🔴 *スケーラビリティのため*
- **WRNFR-003**: システムは検索・フィルタリング処理を500ms以内に完了しなければならない 🔴 *ユーザビリティのため*

### セキュリティ

- **WRNFR-004**: システムはSQL インジェクション対策を実装しなければならない 🔴 *セキュリティ基本要件*
- **WRNFR-005**: システムはXSS(クロスサイトスクリプティング)対策を実装しなければならない 🔴 *セキュリティ基本要件*
- **WRNFR-006**: システムはCSRF(クロスサイトリクエストフォージェリ)対策を実装しなければならない 🔴 *セキュリティ基本要件*

### ユーザビリティ

- **WRNFR-007**: システムは直感的で学習コストの低いUIを提供しなければならない 🔴 *ユーザビリティのため*
- **WRNFR-008**: システムは一貫性のあるデザインシステムを採用しなければならない 🔴 *ユーザビリティのため*

### 保守性

- **WRNFR-009**: システムはコンポーネント志向の設計でなければならない 🟡 *保守性向上のため*
- **WRNFR-010**: システムはESLintとPrettierで静的解析とコード整形を行わなければならない 🟡 *コード品質向上のため*
- **WRNFR-011**: システムはエラーログを記録し、デバッグを容易にしなければならない 🔴 *開発効率のため*

### テスタビリティ

- **WRNFR-012**: システムはユニットテストを実装しなければならない 🔴 *品質保証のため*
- **WRNFR-013**: システムは統合テストを実装しなければならない 🔴 *品質保証のため*
- **WRNFR-014**: システムはE2Eテストを実装してもよい 🔴 *品質保証のため(オプション)*

---

## Edgeケース

### エラー処理

- **WREDGE-001**: データベース接続エラーが発生した場合、システムはユーザーにわかりやすいエラーメッセージを表示しなければならない 🔴 *エラー処理一般要件*
- **WREDGE-002**: ファイルアップロード時にサイズ制限(10MB)を超えた場合、システムはエラーメッセージを表示しなければならない 🔴 *エラー処理一般要件*
- **WREDGE-003**: 不正なJSON形式のインポートファイルを受け取った場合、システムは詳細なエラー位置を表示しなければならない 🔴 *エラー処理一般要件*

### 境界値

- **WREDGE-004**: カード名が100文字を超えた場合、システムはバリデーションエラーを表示しなければならない 🔴 *データ品質保証のため*
- **WREDGE-005**: エネルギーコストがマイナス値の場合、システムはバリデーションエラーを表示しなければならない 🔴 *データ品質保証のため*
- **WREDGE-006**: 難易度が1〜5の範囲外の場合、システムはバリデーションエラーを表示しなければならない 🔵 *ゲーム要件REQ-031より*

### データ整合性

- **WREDGE-007**: 他のリソースから参照されているカードを削除しようとした場合、システムは警告メッセージを表示しなければならない 🔴 *データ整合性のため*
- **WREDGE-008**: 存在しない顧客IDを参照する依頼を作成しようとした場合、システムはエラーメッセージを表示しなければならない 🔴 *データ整合性のため*

---

## データモデル概要

### 主要エンティティ

1. **Card(カード)**
   - id, name, description, cardType, attribute, stabilityValue, reactionEffect, energyCost

2. **Customer(顧客)**
   - id, name, description, customerType, difficulty, requiredAttribute, qualityCondition, stabilityCondition

3. **AlchemyStyle(錬金スタイル)**
   - id, name, description, initialDeck, characteristics

4. **MapNode(マップノード)**
   - id, name, nodeType, description, rewards, eventContent

5. **MetaCurrency(メタ通貨)**
   - id, currencyType, value, description

6. **UnlockableContent(アンロック可能コンテンツ)**
   - id, contentType, contentId, requiredFame, requiredKnowledge

7. **GameBalance(ゲームバランス)**
   - id, setting, value, description

---

## 制約事項

### 技術的制約

- Next.js 14以上を使用
- TypeScript 5.0以上を使用
- Node.js 18以上を使用
- PostgreSQL 14以上を使用

### ビジネス制約

- 無料開発ツール(個人開発プロジェクト)
- 開発期限は設定しない

### 設計制約

- サーバーサイドレンダリング(SSR)とクライアントサイドレンダリング(CSR)の適切な使い分け
- データベースマイグレーションの管理(Prisma Migrate)
- 環境変数による設定管理

---

## 優先順位(MoSCoW法)

### Must Have(必須 - MVP範囲)

- WRREQ-001〜008(プラットフォーム基盤)
- WRREQ-012〜018(カード管理機能)
- WRREQ-021〜026(顧客管理機能)
- WRREQ-029〜031(錬金スタイル管理機能)
- WRREQ-043〜047(データエクスポート/インポート機能)
- WRREQ-052〜057(基本UI/UX)
- WRREQ-059〜063(検索・フィルタリング機能)
- WRREQ-067〜070(API設計)
- WRNFR-001〜006(パフォーマンス・セキュリティ基本)
- WRNFR-009〜011(保守性基本)

### Should Have(推奨 - 正式リリース範囲)

- WRREQ-027〜028(顧客数制約)
- WRREQ-033〜037(マップ・ノード管理機能)
- WRREQ-038〜042(メタ進行データ管理機能)
- WRREQ-048〜051(ゲームバランス調整機能)
- WRNFR-007〜008(ユーザビリティ)
- WRNFR-012〜013(テスト)

### Could Have(あれば良い)

- WRREQ-010〜011(認証・権限管理)
- WRREQ-032(5種類の錬金スタイル)
- WRREQ-064〜066(バージョン管理・履歴機能)
- WRNFR-014(E2Eテスト)

### Won't Have(今回は対象外)

- モバイルアプリ版
- リアルタイム共同編集
- 多言語対応
- ゲームとの直接連携API

---

## 開発フェーズ

### Phase 1: MVP (1〜2週間)

1. プロジェクトセットアップ(Next.js + TypeScript + Prisma + PostgreSQL)
2. データベーススキーマ設計・マイグレーション
3. カード管理機能(CRUD)
4. 顧客管理機能(CRUD)
5. 基本的なUI/UX(ダッシュボード、ナビゲーション)
6. JSONエクスポート/インポート機能

### Phase 2: 正式リリース準備 (2〜3週間)

1. 錬金スタイル管理機能
2. マップ・ノード管理機能
3. メタ進行データ管理機能
4. ゲームバランス調整機能
5. 検索・フィルタリング機能強化
6. UI/UXブラッシュアップ
7. テスト実装

### Phase 3: 拡張機能 (継続的)

1. 認証・権限管理
2. バージョン管理・履歴機能
3. データ分析・可視化機能
4. パフォーマンス最適化

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2025-11-08 | 1.0 | 初版作成 |
