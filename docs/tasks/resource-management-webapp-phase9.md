# Phase 9: 顧客管理UI

## フェーズ概要

**要件名**: resource-management-webapp  
**期間**: 5日（40時間）  
**目標**: 顧客管理UIの実装（一覧、作成、編集、詳細画面）  
**成果物**: 
- 顧客一覧画面実装完了
- 顧客作成画面実装完了（N:Mリレーション処理含む）
- 顧客編集画面実装完了（N:Mリレーション処理含む）
- 顧客詳細画面実装完了
- バリデーション実装完了
- エラーハンドリング実装完了

**関連要件**: WRREQ-025, WRREQ-026, WRREQ-055, WRREQ-056, WRREQ-057, WRREQ-059, WRREQ-061, WRREQ-063, WRNFR-001, WRNFR-003

### タスク統計

- **総タスク数**: 21タスク
- **推定作業時間**: 40時間
- **DIRECTタスク**: 0タスク
- **TDDタスク**: 21タスク

### クリティカルパス

**クリティカルパス**: TASK-0172 → TASK-0173 → TASK-0174 → TASK-0176 → TASK-0177 → TASK-0178 → TASK-0179 → TASK-0180 → TASK-0181 → TASK-0182 → TASK-0183 → TASK-0184 → TASK-0185 → TASK-0186 → TASK-0190 → TASK-0192

---

## 実行順序（ガントチャート）

```mermaid
gantt
    title Phase 9: 顧客管理UI 実行順序
    dateFormat YYYY-MM-DD
    section Day 1
    TASK-901: タスク1 :2025-02-01, 2h
    section Day 2
    TASK-902: タスク2 :2025-02-02, 2h
```

---

## タスクプロセス定義

### TDDタスクの実行プロセス

TDDタスクは以下の6ステップで実行します：

1. `/tsumiki:tdd-requirements` - 詳細要件定義
2. `/tsumiki:tdd-testcases` - テストケース作成
3. `/tsumiki:tdd-red` - テスト実装（失敗）
4. `/tsumiki:tdd-green` - 最小実装
5. `/tsumiki:tdd-refactor` - リファクタリング
6. `/tsumiki:tdd-verify-complete` - 品質確認

### DIRECTタスクの実行プロセス

DIRECTタスクは以下の2ステップで実行します：

1. `/tsumiki:direct-setup` - 直接実装・設定
2. `/tsumiki:direct-verify` - 動作確認・品質確認

---

## 週次計画

### Day 1（8時間）
- **目標**: 顧客一覧画面実装
- **成果物**: 
  - 顧客一覧表示実装
  - 検索・フィルタリング実装
  - ページネーション実装

### Day 2（8時間）
- **目標**: 顧客作成画面実装
- **成果物**: 
  - 顧客作成フォーム実装
  - N:Mリレーション処理実装（報酬カード）
  - バリデーション実装

### Day 3（8時間）
- **目標**: 顧客編集画面実装
- **成果物**: 
  - 顧客編集フォーム実装
  - N:Mリレーション更新処理実装
  - 既存データの読み込み実装

### Day 4（8時間）
- **目標**: 顧客詳細画面実装
- **成果物**: 
  - 顧客詳細表示実装
  - リレーション情報表示実装
  - 削除機能実装

### Day 5（8時間）
- **目標**: テスト実装と動作確認
- **成果物**: 
  - UIテスト実装
  - E2Eテスト実装
  - 動作確認とドキュメント作成

---

## 日次タスク

### Day 1: 顧客一覧画面実装

#### TASK-0172: 顧客一覧画面コンポーネント実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 2.5時間
- **要件**: WRREQ-025, WRREQ-053, WRREQ-054
- **依存タスク**: TASK-0138, TASK-0141, TASK-0145
- **実装詳細**:
  - `src/pages/customers/CustomerListPage.tsx`を作成
  - 顧客一覧を表示
  - Tableコンポーネントを使用
  - レイアウトコンポーネントを使用
- **単体テスト要件**: 
  - 顧客一覧画面が正しく表示されることを確認
- **UI/UX要件**: 
  - レスポンシブデザイン対応（WRREQ-006）
  - パンくずリストで現在位置表示（WRREQ-054）
- **完了条件**: 
  - 顧客一覧画面コンポーネントが完成していること

#### TASK-0173: 検索・フィルタリング機能実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 2.5時間
- **要件**: WRREQ-025, WRREQ-059, WRREQ-061, WRREQ-063, WRNFR-003
- **依存タスク**: TASK-0172, TASK-0140
- **実装詳細**:
  - 検索バーを実装（顧客名での部分一致検索）
  - フィルタを実装（難易度、顧客タイプ）
  - デバウンス処理を実装（500ms）
  - URLクエリパラメータで状態を保持
  - TanStack Queryでデータ取得
- **単体テスト要件**: 
  - 検索・フィルタリングが正しく動作することを確認
- **UI/UX要件**: 
  - 検索・フィルタリング応答時間500ms以内（WRNFR-003）
  - URLクエリパラメータで状態保持（WRREQ-063）
- **完了条件**: 
  - 検索・フィルタリング機能が完成していること

#### TASK-0174: ページネーション機能実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 1.5時間
- **要件**: WRREQ-025, WRNFR-002
- **依存タスク**: TASK-0172
- **実装詳細**:
  - ページネーションコンポーネントを実装（カード管理UIと同様）
  - 前後ページナビゲーションを実装
  - ページ番号表示を実装
  - URLクエリパラメータでページ状態を保持
- **単体テスト要件**: 
  - ページネーションが正しく動作することを確認
- **完了条件**: 
  - ページネーション機能が完成していること

#### TASK-0175: 新規作成ボタン・アクションボタン実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 1.5時間
- **要件**: WRREQ-026
- **依存タスク**: TASK-0172, TASK-0139, TASK-0130
- **実装詳細**:
  - 新規作成ボタンを実装（顧客作成画面へ遷移）
  - 詳細ボタンを実装（顧客詳細画面へ遷移）
  - 編集ボタンを実装（顧客編集画面へ遷移）
  - 削除ボタンを実装（確認ダイアログ表示）
- **単体テスト要件**: 
  - 各ボタンが正しく動作することを確認
- **完了条件**: 
  - 新規作成ボタン・アクションボタンが完成していること

---

### Day 2: 顧客作成画面実装

#### TASK-0176: 顧客作成画面コンポーネント実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 2時間
- **要件**: WRREQ-026, WRREQ-053, WRREQ-054
- **依存タスク**: TASK-0138, TASK-0142
- **実装詳細**:
  - `src/pages/customers/CustomerCreatePage.tsx`を作成
  - 顧客作成フォームを実装
  - レイアウトコンポーネントを使用
- **単体テスト要件**: 
  - 顧客作成画面が正しく表示されることを確認
- **UI/UX要件**: 
  - パンくずリストで現在位置表示（WRREQ-054）
- **完了条件**: 
  - 顧客作成画面コンポーネントが完成していること

#### TASK-0177: 顧客作成フォーム実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 3時間
- **要件**: WRREQ-026, WRREQ-055
- **依存タスク**: TASK-0176, TASK-0140, TASK-0142
- **実装詳細**:
  - React Hook Formを使用
  - Zodバリデーションスキーマを実装
  - 各入力項目を実装（name, description, customerType, difficulty, requiredAttribute, qualityCondition, stabilityCondition, rewardFame, rewardKnowledge, portraitUrl）
  - エラー表示を実装
  - 送信ボタン、キャンセルボタンを実装
- **単体テスト要件**: 
  - フォームが正しく動作することを確認
  - バリデーションが正しく動作することを確認
- **UI/UX要件**: 
  - フォームバリデーションエラーを分かりやすく表示（WRREQ-055）
- **完了条件**: 
  - 顧客作成フォームが完成していること

#### TASK-0178: N:Mリレーション処理実装（報酬カード選択）
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 2時間
- **要件**: WRREQ-024
- **依存タスク**: TASK-0177, TASK-0144
- **実装詳細**:
  - 報酬カード選択コンポーネントを実装
  - カード一覧を取得して表示
  - 複数選択可能なUIを実装
  - 選択したカードIDをフォームに設定
  - バリデーションを実装（存在チェック）
- **単体テスト要件**: 
  - N:Mリレーション処理が正しく動作することを確認
- **完了条件**: 
  - N:Mリレーション処理が完成していること

#### TASK-0179: 顧客作成処理実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 1時間
- **要件**: WRREQ-026, WRREQ-057
- **依存タスク**: TASK-0177, TASK-0178, TASK-0145
- **実装詳細**:
  - TanStack QueryのuseMutationを使用
  - 顧客作成APIを呼び出し（rewardCardIdsを含む）
  - 成功時にToast通知を表示
  - 成功時に顧客一覧画面へ遷移
  - エラー時にエラーメッセージを表示
- **単体テスト要件**: 
  - 顧客作成処理が正しく動作することを確認
- **UI/UX要件**: 
  - 操作成功時にトースト通知表示（WRREQ-057）
- **完了条件**: 
  - 顧客作成処理が完成していること

---

### Day 3: 顧客編集画面実装

#### TASK-0180: 顧客編集画面コンポーネント実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 2時間
- **要件**: WRREQ-026, WRREQ-053, WRREQ-054
- **依存タスク**: TASK-0138, TASK-0142
- **実装詳細**:
  - `src/pages/customers/CustomerEditPage.tsx`を作成
  - 顧客編集フォームを実装
  - レイアウトコンポーネントを使用
- **単体テスト要件**: 
  - 顧客編集画面が正しく表示されることを確認
- **UI/UX要件**: 
  - パンくずリストで現在位置表示（WRREQ-054）
- **完了条件**: 
  - 顧客編集画面コンポーネントが完成していること

#### TASK-0181: 既存データの読み込み実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 1.5時間
- **要件**: WRREQ-026
- **依存タスク**: TASK-0180, TASK-0145
- **実装詳細**:
  - 顧客IDをURLパラメータから取得
  - TanStack QueryのuseQueryで顧客データを取得
  - フォームに既存データを設定
  - 報酬カードの選択状態を設定
  - ローディング状態を表示
  - 404エラーハンドリング
- **単体テスト要件**: 
  - 既存データの読み込みが正しく動作することを確認
- **完了条件**: 
  - 既存データの読み込みが完成していること

#### TASK-0182: 顧客編集フォーム実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 2.5時間
- **要件**: WRREQ-026, WRREQ-055
- **依存タスク**: TASK-0181, TASK-0140, TASK-0142
- **実装詳細**:
  - React Hook Formを使用
  - 部分更新対応のZodバリデーションスキーマを実装
  - 各入力項目を実装（顧客作成フォームと同様）
  - 報酬カード選択コンポーネントを実装
  - エラー表示を実装
  - 送信ボタン、キャンセルボタンを実装
- **単体テスト要件**: 
  - フォームが正しく動作することを確認
  - 部分更新が正しく動作することを確認
- **UI/UX要件**: 
  - フォームバリデーションエラーを分かりやすく表示（WRREQ-055）
- **完了条件**: 
  - 顧客編集フォームが完成していること

#### TASK-0183: N:Mリレーション更新処理実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 1.5時間
- **要件**: WRREQ-024
- **依存タスク**: TASK-0182, TASK-0145
- **実装詳細**:
  - 報酬カードの更新処理を実装
  - 既存の選択状態を表示
  - 選択変更を検知
  - 更新APIにrewardCardIdsを含める
- **単体テスト要件**: 
  - N:Mリレーション更新処理が正しく動作することを確認
- **完了条件**: 
  - N:Mリレーション更新処理が完成していること

#### TASK-0184: 顧客更新処理実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 0.5時間
- **要件**: WRREQ-026, WRREQ-057
- **依存タスク**: TASK-0182, TASK-0183, TASK-0145
- **実装詳細**:
  - TanStack QueryのuseMutationを使用
  - 顧客更新APIを呼び出し
  - 成功時にToast通知を表示
  - 成功時に顧客詳細画面へ遷移
  - エラー時にエラーメッセージを表示
- **単体テスト要件**: 
  - 顧客更新処理が正しく動作することを確認
- **UI/UX要件**: 
  - 操作成功時にトースト通知表示（WRREQ-057）
- **完了条件**: 
  - 顧客更新処理が完成していること

---

### Day 4: 顧客詳細画面実装

#### TASK-0185: 顧客詳細画面コンポーネント実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 2.5時間
- **要件**: WRREQ-025, WRREQ-053, WRREQ-054
- **依存タスク**: TASK-0138, TASK-0145
- **実装詳細**:
  - `src/pages/customers/CustomerDetailPage.tsx`を作成
  - 顧客詳細情報を表示
  - レイアウトコンポーネントを使用
- **単体テスト要件**: 
  - 顧客詳細画面が正しく表示されることを確認
- **UI/UX要件**: 
  - パンくずリストで現在位置表示（WRREQ-054）
- **完了条件**: 
  - 顧客詳細画面コンポーネントが完成していること

#### TASK-0186: リレーション情報表示実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 2時間
- **要件**: WRREQ-024
- **依存タスク**: TASK-0185
- **実装詳細**:
  - 報酬カード（rewardCards）を表示（N:Mリレーション）
  - マップノード（mapNodes）を表示（1:Nリレーション）
  - アンロック条件（unlockableContent）を表示（1:1リレーション）
  - リンクを実装（関連カード、マップノードへの遷移）
- **単体テスト要件**: 
  - リレーション情報が正しく表示されることを確認
- **完了条件**: 
  - リレーション情報表示が完成していること

#### TASK-0187: 削除機能実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 2時間
- **要件**: WRREQ-026, WRREQ-056, WRREQ-057
- **依存タスク**: TASK-0185, TASK-0145
- **実装詳細**:
  - 削除ボタンを実装
  - 確認ダイアログを実装
  - 依存関係チェックを実装
  - 削除APIを呼び出し
  - 成功時にToast通知を表示
  - 成功時に顧客一覧画面へ遷移
  - 依存関係エラー時のハンドリング
- **単体テスト要件**: 
  - 削除機能が正しく動作することを確認
- **UI/UX要件**: 
  - 削除操作時に確認ダイアログ表示（WRREQ-056）
  - 操作成功時にトースト通知表示（WRREQ-057）
- **完了条件**: 
  - 削除機能が完成していること

#### TASK-0188: アクションボタン実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 1.5時間
- **要件**: WRREQ-026
- **依存タスク**: TASK-0185, TASK-0139, TASK-0130
- **実装詳細**:
  - 編集ボタンを実装（顧客編集画面へ遷移）
  - 一覧へ戻るボタンを実装（顧客一覧画面へ遷移）
  - 削除ボタンを実装（確認ダイアログ表示）
- **単体テスト要件**: 
  - 各ボタンが正しく動作することを確認
- **完了条件**: 
  - アクションボタンが完成していること

---

### Day 5: テスト実装と動作確認

#### TASK-0189: UIテスト実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 2.5時間
- **要件**: WRNFR-012
- **依存タスク**: TASK-0172, TASK-0176, TASK-0180, TASK-0185
- **実装詳細**:
  - 各画面のテストを実装
  - React Testing Libraryを使用
  - ユーザーインタラクションのテストを実装
  - N:Mリレーション処理のテストを実装
  - テストカバレッジ80%以上を目標
- **単体テスト要件**: 
  - すべてのテストがパスすることを確認
- **完了条件**: 
  - UIテストが完成していること

#### TASK-0190: E2Eテスト実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 2.5時間
- **要件**: WRNFR-014
- **依存タスク**: TASK-0189
- **実装詳細**:
  - Playwrightを使用してE2Eテストを実装
  - 顧客一覧表示のテストを実装
  - 顧客作成のテストを実装（N:Mリレーション処理含む）
  - 顧客編集のテストを実装（N:Mリレーション更新含む）
  - 顧客削除のテストを実装
- **E2Eテスト要件**: 
  - すべてのE2Eテストがパスすることを確認
- **完了条件**: 
  - E2Eテストが完成していること

#### TASK-0191: パフォーマンステスト実装
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: TDD
- **推定工数**: 1.5時間
- **要件**: WRNFR-001, WRNFR-003
- **依存タスク**: TASK-0172, TASK-0173
- **実装詳細**:
  - 一覧画面の初期表示時間を測定（目標: 2秒以内）
  - 検索・フィルタリングの応答時間を測定（目標: 500ms以内）
  - パフォーマンステストを実装
- **完了条件**: 
  - パフォーマンステストが完成していること
  - パフォーマンス要件を満たしていること

#### TASK-0192: 動作確認とドキュメント作成
- [ ] **タスク完了**
- <!-- GitHub Issue: # -->
- **タスクタイプ**: DIRECT
- **推定工数**: 1.5時間
- **要件**: なし（一般的な開発プロセス）
- **依存タスク**: TASK-0189, TASK-0190, TASK-0191
- **実装詳細**:
  - すべての画面の動作確認を実施
  - N:Mリレーション処理の確認を実施
  - レスポンシブデザインの確認を実施
  - アクセシビリティの確認を実施
  - ドキュメントを作成
- **完了条件**: 
  - すべての機能が正常に動作すること
  - ドキュメントが完成していること

---

## フェーズ完了条件

- [ ] 顧客一覧画面が実装されていること
- [ ] 顧客作成画面が実装されていること（N:Mリレーション処理含む）
- [ ] 顧客編集画面が実装されていること（N:Mリレーション更新処理含む）
- [ ] 顧客詳細画面が実装されていること
- [ ] バリデーションが実装されていること
- [ ] エラーハンドリングが実装されていること
- [ ] すべてのテストがパスしていること
- [ ] パフォーマンス要件を満たしていること

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2025-01-XX | 1.0 | 初版作成 |

