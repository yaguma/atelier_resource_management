# 画面設計

**【信頼性レベル】**:
- 🔵 **青信号**: 要件定義書から直接導出された確実な画面設計
- 🟡 **黄信号**: 要件定義書から妥当な推測による画面設計
- 🔴 **赤信号**: 一般的なWebアプリ管理画面のベストプラクティスから推測

---

## 画面一覧

| 画面ID | 画面名 | URL/ルート | 目的 | 対象ユーザー |
|--------|--------|-----------|------|------------|
| SCREEN-001 | ダッシュボード | `/` | 統計情報の表示 | ゲーム開発者、ゲームデザイナー |
| SCREEN-002 | カード一覧画面 | `/cards` | カードの一覧表示、検索、フィルタリング | ゲーム開発者、ゲームデザイナー |
| SCREEN-003 | カード作成画面 | `/cards/new` | 新規カードの作成 | ゲーム開発者、ゲームデザイナー |
| SCREEN-004 | カード編集画面 | `/cards/:id/edit` | 既存カードの編集 | ゲーム開発者、ゲームデザイナー |
| SCREEN-005 | カード詳細画面 | `/cards/:id` | カードの詳細情報表示 | ゲーム開発者、ゲームデザイナー |
| SCREEN-006 | 顧客一覧画面 | `/customers` | 顧客の一覧表示、検索、フィルタリング | ゲーム開発者、ゲームデザイナー |
| SCREEN-007 | 顧客作成画面 | `/customers/new` | 新規顧客の作成 | ゲーム開発者、ゲームデザイナー |
| SCREEN-008 | 顧客編集画面 | `/customers/:id/edit` | 既存顧客の編集 | ゲーム開発者、ゲームデザイナー |
| SCREEN-009 | 顧客詳細画面 | `/customers/:id` | 顧客の詳細情報表示 | ゲーム開発者、ゲームデザイナー |
| SCREEN-010 | 錬金スタイル一覧画面 | `/alchemy-styles` | 錬金スタイルの一覧表示 | ゲーム開発者、ゲームデザイナー |
| SCREEN-011 | 錬金スタイル作成画面 | `/alchemy-styles/new` | 新規錬金スタイルの作成 | ゲーム開発者、ゲームデザイナー |
| SCREEN-012 | 錬金スタイル編集画面 | `/alchemy-styles/:id/edit` | 既存錬金スタイルの編集 | ゲーム開発者、ゲームデザイナー |
| SCREEN-013 | データエクスポート/インポート画面 | `/import-export` | データのエクスポート/インポート | ゲーム開発者、ゲームデザイナー |

---

## SCREEN-001: ダッシュボード

### 基本情報
- **画面ID**: SCREEN-001
- **画面名**: ダッシュボード
- **URL/ルート**: `/`
- **目的**: 統計情報の表示 🔵 *要件WRREQ-052より*
- **対象ユーザー**: ゲーム開発者、ゲームデザイナー

### レイアウト
- **ヘッダー**: アプリタイトル「リソース管理Webアプリ」、ナビゲーションメニュー
- **サイドバー**: 左サイドバーでナビゲーション 🔵 *要件WRREQ-053より*
- **メインコンテンツ**: 統計情報カード（総カード数、総顧客数、総錬金スタイル数など）
- **フッター**: なし

### レスポンシブ対応 🔵 *要件WRREQ-006より*
- **デスクトップ（lg以上）**: サイドバー表示、統計カードを3列表示
- **タブレット（md）**: サイドバー折りたたみ可能、統計カードを2列表示
- **モバイル（sm以下）**: サイドバー非表示、統計カードを1列表示

### 画面要素

#### 統計情報カード
- **位置**: メインコンテンツ上部
- **要素**: 
  - 総カード数カード（アイコン: カード、数値、前回比）
  - 総顧客数カード（アイコン: 顧客、数値、前回比）
  - 総錬金スタイル数カード（アイコン: スタイル、数値、前回比）
  - 総マップノード数カード（アイコン: ノード、数値、前回比）
- **スタイル**: TailwindCSS `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4`

### データ表示
- **API**: `GET /api/cards` (count), `GET /api/customers` (count), `GET /api/alchemy-styles` (count), `GET /api/map-nodes` (count)
- **表示項目**: 各リソースの総数
- **ローディング状態**: スケルトンローダー表示
- **データなし**: 統計情報を0として表示

### 操作フロー
1. 画面表示時に各リソースの総数を取得（TanStack Query）
2. 統計カードを表示

### 状態管理
- **サーバー状態**: TanStack Query
  - `useQuery` で各リソースの総数取得
  - `staleTime`: 5分、`cacheTime`: 10分

### エラーハンドリング
- **APIエラー時**: Toast通知でエラーメッセージ表示
- **ネットワークエラー**: "ネットワークエラーが発生しました。接続を確認してください" メッセージ表示

---

## SCREEN-002: カード一覧画面

### 基本情報
- **画面ID**: SCREEN-002
- **画面名**: カード一覧画面
- **URL/ルート**: `/cards`
- **目的**: カードの一覧表示、検索、フィルタリング 🔵 *要件WRREQ-016より*
- **対象ユーザー**: ゲーム開発者、ゲームデザイナー

### レイアウト
- **ヘッダー**: アプリタイトル、ナビゲーションメニュー
- **サイドバー**: メニュー（カード管理、顧客管理、錬金スタイル管理等）
- **メインコンテンツ**: カード一覧テーブル、検索バー、フィルタ
- **フッター**: なし

### レスポンシブ対応
- **デスクトップ（lg以上）**: サイドバー表示、テーブル全列表示
- **タブレット（md）**: サイドバー折りたたみ可能、テーブル主要列表示
- **モバイル（sm以下）**: サイドバー非表示、カード形式で表示

### 画面要素

#### パンくずリスト 🔵 *要件WRREQ-054より*
- **位置**: メインコンテンツ上部
- **要素**: ホーム > カード管理
- **スタイル**: TailwindCSS `text-sm text-gray-500`

#### 検索バー 🔵 *要件WRREQ-059より*
- **位置**: メインコンテンツ上部中央
- **要素**: 
  - テキスト入力欄（プレースホルダー: "カード名で検索..."）
  - 検索ボタン（アイコン: 虫眼鏡）
- **機能**: カード名での部分一致検索
- **スタイル**: TailwindCSS `border rounded-lg px-4 py-2`
- **デバウンス**: 500ms後にAPI呼び出し 🔴

#### フィルタ 🔵 *要件WRREQ-060より*
- **位置**: 検索バーの下
- **要素**: 
  - カード系統ドロップダウン（全系統、MATERIAL、OPERATION、CATALYST、KNOWLEDGE、SPECIAL、ARTIFACT）
  - レアリティドロップダウン（全レアリティ、COMMON、UNCOMMON、RARE、EPIC、LEGENDARY）
  - リセットボタン
- **機能**: 選択した条件でフィルタリング
- **スタイル**: TailwindCSS `flex gap-4`

#### カード一覧テーブル
- **位置**: フィルタの下
- **列**: 
  - ID（幅: 80px）
  - カード名（幅: 200px、ソート可能）
  - カード系統（幅: 100px、ソート可能）
  - レアリティ（幅: 100px、ソート可能）
  - エネルギーコスト（幅: 120px、ソート可能）
  - 作成日時（幅: 150px、ソート可能）
  - アクション（幅: 150px）
- **ソート**: 各列ヘッダークリックで昇順/降順切り替え
- **ページネーション**: 20件/ページ、前後ページナビゲーション 🔵 *要件定義書より*
- **スタイル**: TailwindCSS `table-auto w-full`

#### 新規作成ボタン
- **位置**: 右上（検索バーの右）
- **要素**: ボタン（テキスト: "新規作成"、アイコン: +）
- **機能**: カード作成画面（SCREEN-003）へ遷移
- **スタイル**: TailwindCSS `bg-blue-500 text-white px-4 py-2 rounded`

#### アクションボタン（各行）
- **要素**: 
  - 詳細ボタン（アイコン: 目）
  - 編集ボタン（アイコン: 鉛筆）
  - 削除ボタン（アイコン: ゴミ箱）
- **機能**: 
  - 詳細: カード詳細画面（SCREEN-005）へ遷移
  - 編集: カード編集画面（SCREEN-004）へ遷移
  - 削除: 確認ダイアログ表示後、削除API呼び出し 🔵 *要件WRREQ-056より*

### データ表示
- **API**: `GET /api/cards?page=1&limit=20&search={検索文字列}&cardType={カード系統}&rarity={レアリティ}`
- **表示項目**: Card型の各フィールド（id, name, cardType, rarity, energyCost, createdAt等）
- **ローディング状態**: スケルトンローダー表示
- **データなし**: "カードが見つかりません"メッセージ表示

### 操作フロー
1. 画面表示時にカード一覧を取得（TanStack Query）
2. 検索バーに入力 → Enterキーまたは検索ボタンクリック → 検索実行（デバウンス500ms）
3. フィルタで条件選択 → 自動的にフィルタリング実行
4. テーブル行クリック → カード詳細画面（SCREEN-005）へ遷移
5. 新規作成ボタンクリック → カード作成画面（SCREEN-003）へ遷移
6. 削除ボタンクリック → 確認ダイアログ表示 → OKで削除API呼び出し → 一覧更新

### 状態管理
- **サーバー状態**: TanStack Query
  - `useQuery` でカード一覧取得
  - `useMutation` で削除処理
  - `staleTime`: 5分、`cacheTime`: 10分
- **クライアント状態**: React Hooks
  - `useState` で検索文字列、フィルタ条件、ページ番号を管理
  - URLクエリパラメータで状態を保持 🔵 *要件WRREQ-063より*

### エラーハンドリング 🔵 *要件WRREQ-055より*
- **APIエラー時**: Toast通知でエラーメッセージ表示（例: "カードの取得に失敗しました"）
- **データなし**: テーブル部分に "カードが見つかりません" メッセージ表示
- **ネットワークエラー**: "ネットワークエラーが発生しました。接続を確認してください" メッセージ表示

### アクセシビリティ
- **キーボード操作**: Tabキーで各要素を順番にフォーカス移動
- **ARIA属性**: `aria-label` でボタンの説明、`aria-sort` でソート状態を明示
- **フォーカス管理**: 削除確認ダイアログ表示時、フォーカスをダイアログ内に移動

### パフォーマンス要件 🔵 *要件WRNFR-001, WRNFR-003より*
- **初期表示時間**: 2秒以内
- **検索・フィルタリング応答時間**: 500ms以内
- **最適化**: 
  - デバウンス処理（検索入力500ms後にAPI呼び出し）
  - 仮想スクロール（100件以上の場合）

### 技術的詳細
- **使用コンポーネント**: shadcn/ui Table, Button, Input, Select
- **API呼び出し**: Axios `GET /api/cards`
- **型定義**: `interfaces.ts` の `Card` 型を参照

---

## SCREEN-003: カード作成画面

### 基本情報
- **画面ID**: SCREEN-003
- **画面名**: カード作成画面
- **URL/ルート**: `/cards/new`
- **目的**: 新規カードの作成 🔵 *要件WRREQ-017より*
- **対象ユーザー**: ゲーム開発者、ゲームデザイナー

### レイアウト
- **ヘッダー**: アプリタイトル、ナビゲーションメニュー
- **サイドバー**: メニュー
- **メインコンテンツ**: カード作成フォーム
- **フッター**: なし

### 画面要素

#### パンくずリスト
- **位置**: メインコンテンツ上部
- **要素**: ホーム > カード管理 > 新規作成

#### フォーム
- **位置**: メインコンテンツ中央
- **幅**: 最大800px、中央配置

#### 入力項目

| 項目名 | データ型 | 必須 | バリデーション | プレースホルダー |
|--------|---------|------|---------------|-----------------|
| カード名 | string | 必須 | 1〜100文字、重複チェック | "カード名を入力" |
| 説明 | string | 必須 | 1〜1000文字 | "カードの説明を入力" |
| カード系統 | enum | 必須 | 選択必須 | - |
| 属性値 | JSON | 必須 | JSON形式、バリデーション | "{\"fire\": 5}" |
| 安定値 | number | 必須 | -100〜100の整数 | "0" |
| 反応効果 | string | 任意 | 最大500文字 | "反応効果を入力" |
| エネルギーコスト | number | 必須 | 0〜5の整数 | "0" |
| 画像URL | string | 任意 | URL形式 | "https://..." |
| レアリティ | enum | 任意 | 選択 | - |
| 進化元カード | string | 任意 | UUID形式 | - |

#### バリデーションルール（Zodスキーマ） 🔵 *要件WRREQ-001-5より*
```typescript
const cardSchema = z.object({
  name: z.string().min(1).max(100),
  description: z.string().min(1).max(1000),
  cardType: z.enum(['MATERIAL', 'OPERATION', 'CATALYST', 'KNOWLEDGE', 'SPECIAL', 'ARTIFACT']),
  attribute: z.record(z.number()),
  stabilityValue: z.number().int().min(-100).max(100),
  reactionEffect: z.string().max(500).optional().nullable(),
  energyCost: z.number().int().min(0).max(5),
  imageUrl: z.string().url().optional().nullable(),
  rarity: z.enum(['COMMON', 'UNCOMMON', 'RARE', 'EPIC', 'LEGENDARY']).optional().nullable(),
  evolutionFromId: z.string().uuid().optional().nullable(),
});
```

#### エラーメッセージ 🔵 *要件WRREQ-055より*
- **カード名**: "カード名は1〜100文字で入力してください"
- **説明**: "説明は1〜1000文字で入力してください"
- **カード系統**: "カード系統を選択してください"
- **属性値**: "属性値はJSON形式で入力してください"
- **安定値**: "安定値は-100〜100の範囲で入力してください"
- **エネルギーコスト**: "エネルギーコストは0〜5の範囲で入力してください"

#### ボタン
- **送信ボタン**: フォーム送信（API呼び出し）
- **キャンセルボタン**: カード一覧画面（SCREEN-002）へ戻る
- **位置**: フォーム下部、右寄せ

#### 初期値
- すべて空（新規作成のため）

### 操作フロー
1. フォームに入力
2. 送信ボタンクリック → Zodバリデーション実行
3. バリデーション成功 → API呼び出し（`POST /api/cards`）
4. 成功 → Toast通知表示 🔵 *要件WRREQ-057より* → カード一覧画面（SCREEN-002）へ遷移
5. エラー → フォーム内にエラーメッセージ表示

### 状態管理
- **フォーム状態**: React Hook Form 🔵 *要件定義書より*
- **サーバー状態**: TanStack Query `useMutation` で作成処理

### エラーハンドリング
- **バリデーションエラー**: 各フィールド下に赤字でエラーメッセージ表示
- **APIエラー**: Toast通知でエラーメッセージ表示
- **重複エラー**: "このカード名は既に使用されています" メッセージ表示 🔵 *要件WRREQ-020より*

---

## SCREEN-004: カード編集画面

### 基本情報
- **画面ID**: SCREEN-004
- **画面名**: カード編集画面
- **URL/ルート**: `/cards/:id/edit`
- **目的**: 既存カードの編集 🔵 *要件WRREQ-017より*
- **対象ユーザー**: ゲーム開発者、ゲームデザイナー

### レイアウト
- SCREEN-003と同様（フォーム形式）

### 画面要素
- SCREEN-003と同様（入力項目、バリデーション、ボタン）

### 初期値
- APIから取得した既存カードデータ（`GET /api/cards/:id`）でフォームを初期化

### 操作フロー
1. 画面表示時にカードデータを取得
2. フォームに入力・編集
3. 送信ボタンクリック → バリデーション実行
4. 成功 → API呼び出し（`PUT /api/cards/:id`）
5. 成功 → Toast通知表示 → カード詳細画面（SCREEN-005）へ遷移

---

## SCREEN-005: カード詳細画面

### 基本情報
- **画面ID**: SCREEN-005
- **画面名**: カード詳細画面
- **URL/ルート**: `/cards/:id`
- **目的**: カードの詳細情報表示
- **対象ユーザー**: ゲーム開発者、ゲームデザイナー

### レイアウト
- **ヘッダー**: アプリタイトル、ナビゲーションメニュー
- **サイドバー**: メニュー
- **メインコンテンツ**: カード詳細情報、アクションボタン
- **フッター**: なし

### 画面要素

#### パンくずリスト
- **位置**: メインコンテンツ上部
- **要素**: ホーム > カード管理 > {カード名}

#### カード情報表示
- **位置**: メインコンテンツ中央
- **表示項目**: 
  - ID
  - カード名
  - 説明
  - カード系統
  - 属性値
  - 安定値
  - 反応効果
  - エネルギーコスト
  - 画像URL
  - レアリティ
  - 進化元カード
  - 進化先カード
  - 初期デッキに含む錬金スタイル
  - アンロック条件
  - 作成日時
  - 更新日時

#### アクションボタン
- **編集ボタン**: カード編集画面（SCREEN-004）へ遷移
- **削除ボタン**: 確認ダイアログ表示後、削除API呼び出し
- **一覧へ戻るボタン**: カード一覧画面（SCREEN-002）へ遷移
- **位置**: カード情報の下、右寄せ

### データ表示
- **API**: `GET /api/cards/:id`
- **ローディング状態**: スケルトンローダー表示

### 操作フロー
1. 画面表示時にカードデータを取得
2. 編集ボタンクリック → カード編集画面（SCREEN-004）へ遷移
3. 削除ボタンクリック → 確認ダイアログ表示 → OKで削除API呼び出し → カード一覧画面（SCREEN-002）へ遷移
4. 一覧へ戻るボタンクリック → カード一覧画面（SCREEN-002）へ遷移

### エラーハンドリング
- **404エラー**: "カードが見つかりません" メッセージ表示 → カード一覧画面へリダイレクト
- **その他のエラー**: Toast通知でエラーメッセージ表示

---

## SCREEN-006〜SCREEN-009: 顧客管理画面

顧客管理画面（一覧、作成、編集、詳細）は、カード管理画面（SCREEN-002〜SCREEN-005）と同様の設計とする。 🔵 *要件WRREQ-025, WRREQ-026より*

### 主な違い
- **URL**: `/customers`, `/customers/new`, `/customers/:id/edit`, `/customers/:id`
- **フィルタ**: 難易度、顧客タイプでフィルタリング 🔵 *要件WRREQ-061より*
- **入力項目**: 顧客固有の項目（難易度、必要属性値、品質条件、安定性条件、報酬等）
- **N:Mリレーション**: 報酬カードの選択（複数選択可能）

---

## SCREEN-010〜SCREEN-012: 錬金スタイル管理画面

錬金スタイル管理画面（一覧、作成、編集）は、カード管理画面と同様の設計とする。 🔵 *要件WRREQ-031より*

### 主な違い
- **URL**: `/alchemy-styles`, `/alchemy-styles/new`, `/alchemy-styles/:id/edit`
- **入力項目**: 錬金スタイル固有の項目（特徴、初期デッキカード等）
- **N:Mリレーション**: 初期デッキカードの選択（複数選択可能）

---

## SCREEN-013: データエクスポート/インポート画面

### 基本情報
- **画面ID**: SCREEN-013
- **画面名**: データエクスポート/インポート画面
- **URL/ルート**: `/import-export`
- **目的**: データのエクスポート/インポート 🔵 *要件WRREQ-043, WRREQ-044より*
- **対象ユーザー**: ゲーム開発者、ゲームデザイナー

### レイアウト
- **ヘッダー**: アプリタイトル、ナビゲーションメニュー
- **サイドバー**: メニュー
- **メインコンテンツ**: エクスポートセクション、インポートセクション
- **フッター**: なし

### 画面要素

#### エクスポートセクション
- **位置**: メインコンテンツ上部
- **要素**: 
  - エクスポート対象リソース選択（チェックボックス: cards, customers, alchemyStyles, mapNodes等）
  - エクスポートボタン
- **機能**: 選択したリソースをJSON形式でエクスポート 🔵 *要件WRREQ-043より*

#### インポートセクション
- **位置**: エクスポートセクションの下
- **要素**: 
  - ファイル選択ボタン
  - インポートボタン
  - バリデーション結果表示エリア
- **機能**: JSONファイルをインポート 🔵 *要件WRREQ-044より*

### 操作フロー

#### エクスポート
1. エクスポート対象リソースを選択
2. エクスポートボタンクリック → API呼び出し（`GET /api/export?resources=...`）
3. 成功 → JSONファイルダウンロード

#### インポート
1. ファイル選択ボタンクリック → JSONファイルを選択
2. インポートボタンクリック → API呼び出し（`POST /api/import`）
3. バリデーション実行 🔵 *要件WRREQ-046より*
4. 成功 → Toast通知表示 → インポート結果表示
5. エラー → エラーメッセージ表示 🔵 *要件WRREQ-047より*

### エラーハンドリング
- **バリデーションエラー**: 詳細なエラーメッセージを表示 🔵 *要件WRREQ-047より*
- **ファイルサイズエラー**: "ファイルサイズが10MBを超えています" メッセージ表示 🔴
- **APIエラー**: Toast通知でエラーメッセージ表示

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2025-01-XX | 1.0 | 初版作成 |

